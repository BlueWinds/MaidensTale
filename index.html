<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>The Maiden's Tale</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">

    <script>(function() {
  Object.defineProperty(Array.prototype, 'wordJoin', {
    value: function() {
      var str;
      if (this.length > 1) {
        str = this.slice(0, -1).join(', ');
        str += ' and ' + this[this.length - 1];
        return str;
      }
      return this.join('');
    }
  });

  Object.values = Object.values || function(o) {
    return Object.keys(o).map(function(k) {
      return o[k];
    });
  };

  Object.firstValue = function(obj) {
    return obj[Object.keys(obj)[0]];
  };

  Object.pickBy = function(obj, filter) {
    var key, n, value;
    n = {};
    for (key in obj) {
      value = obj[key];
      if (filter(value, key)) {
        n[key] = value;
      }
    }
    return n;
  };

  Object.defaults = function(object, origin) {
    var key, value;
    for (key in origin) {
      value = origin[key];
      if (object[key] == null) {
        object[key] = value;
      }
    }
    return object;
  };

  Object.defaultsDeep = function(object, origin) {
    var key, value;
    for (key in origin) {
      value = origin[key];
      if (value instanceof Array) {
        if (object[key] != null) {
          continue;
        }
        object[key] = [];
        Object.defaultsDeep(object[key], value);
      } else if (typeof value === 'object') {
        if (object[key] == null) {
          object[key] = {};
        }
        if (typeof object[key] !== 'object') {
          continue;
        }
        Object.defaultsDeep(object[key], value);
      } else if (object[key] == null) {
        object[key] = value;
      }
    }
    return object;
  };

  Math.sum = function(array) {
    var i, len, sum, v;
    sum = 0;
    for (i = 0, len = array.length; i < len; i++) {
      v = array[i];
      sum += v;
    }
    return sum;
  };

  window.smoothScroll = function(targetY) {
    var duration, easing, startTime, startY, tick;
    startY = window.scrollY;
    duration = Math.max(100, Math.min(800, Math.abs(scrollY - targetY) / 2000 * 1000));
    easing = function(pos) {
      return Math.sin(pos * (Math.PI / 2));
    };
    startTime = null;
    tick = function(time) {
      var p, scroll;
      startTime || (startTime = time);
      p = Math.min(1, (time - startTime) / duration);
      scroll = easing(p);
      window.scrollTo(0, startY + ((targetY - startY) * scroll));
      if (p < 1) {
        return requestAnimationFrame(tick);
      }
    };
    return requestAnimationFrame(tick);
  };

}).call(this);

(function() {
  window.Data = {
    randomEvents: {},
    jobs: {},
    events: {},
    pseudoEvents: {},
    adventures: {},
    times: ['Morning', 'Evening', 'Night'],
    dailyEventChance: 0.6,
    difficulty: {
      easy: 0.6,
      normal: 1,
      hard: 1.5
    },
    storytellers: {
      danni: {
        gender: 'f',
        first: 'Danni',
        last: 'Jemson'
      },
      nick: {
        gender: 'm',
        first: 'Nick',
        last: 'Romanov'
      },
      sarah: {
        gender: 'f',
        first: 'Sarah',
        last: 'Lanshi'
      }
    },
    opposedMood: {
      Pride: 'Humility',
      Humility: 'Pride',
      Hope: 'Despair',
      Despair: 'Hope',
      Spirit: 'Detachment',
      Detachment: 'Spirit'
    },
    dailyChoices: {
      Clothes: {
        from: 'availableClothes',
        descriptions: {
          Sundress: "Skimpy flower-patterned sun dress",
          Jeans: "X-backed teal blouse and skinny jeans",
          Miniskirt: "Hip-hugging black miniskirt and low cut red blouse"
        }
      }
    }
  };

  window.Game = {
    day: 0,
    events: {
      Intro: 0
    },
    history: [['Intro']],
    upcoming: [],
    plans: ['Exercise', 'WaitCell', 'WaitCell'],
    adventure: "IntroAdventure",
    name: 'unnamed',
    background: 'Rich',
    profession: 'Student',
    storyteller: 'danni',
    confined: 'cell',
    punishment: false,
    Clothes: 'Sundress',
    availableClothes: {
      Sundress: false,
      Jeans: false,
      Miniskirt: false
    },
    mood: {
      Pride: 0,
      Humility: 0,
      Hope: 0,
      Despair: 0,
      Spirit: 0,
      Detachment: 0
    },
    skills: {
      Anal: 0,
      Baking: 0,
      Bluffing: 0,
      Climbing: 0,
      Concentration: 0,
      Cooking: 0,
      Dancing: 0,
      Endurance: 0,
      Etiquette: 0,
      Fashion: 0,
      Flattery: 0,
      Flirting: 0,
      'Gag Reflex': 0,
      Immodesty: 0,
      Instruments: 0,
      Intimidation: 0,
      Literature: 0,
      Lockpicking: 0,
      Makeup: 0,
      Mathematics: 0,
      Medicine: 0,
      Memorization: 0,
      Oral: 0,
      Seduction: 0,
      Singing: 0,
      Strength: 0,
      Temperance: 0
    }
  };

}).call(this);

(function() {
  var clamp, clothesDesc, dayToTimeString, moodSlider, skillSlider;

  Data.events.AboutYou = {
    text: function() {
      var alreadySeenMoods, label, moodSliders, opposed, rating, skillSliders;
      alreadySeenMoods = {};
      moodSliders = (function() {
        var ref, results;
        ref = g.mood;
        results = [];
        for (label in ref) {
          rating = ref[label];
          if (!(!alreadySeenMoods[label])) {
            continue;
          }
          opposed = Data.opposedMood[label];
          alreadySeenMoods[opposed] = true;
          results.push("<div><label>" + label + "<br>" + opposed + "</label>" + (moodSlider(rating, g.mood[opposed])) + "</div>");
        }
        return results;
      })();
      skillSliders = (function() {
        var ref, results;
        ref = g.skills;
        results = [];
        for (label in ref) {
          rating = ref[label];
          results.push("<div><label>" + label + "</label>" + (skillSlider(rating)) + "</div>");
        }
        return results;
      })();
      return "You are " + g.name + ", property of " + mistress + " " + Masterson + ", bought and paid for at an auction " + (dayToTimeString(g.day)) + " ago. You stand a delicate 5' 3\", your slight frame weighing in at 110 lbs. You have shoulder-length staight hair and are currently wearing " + (g.events.NamingDone != null ? 'nothing at all' : clothesDesc[g.clothes]) + ". Before becoming a slave, you were a " + g.background + " " + g.profession + ".\n\n<div class=\"sliders stats\">" + (moodSliders.join('')) + "</div>\n\n<div class=\"sliders\">" + (skillSliders.join('')) + "</div>\n\n" + options;
    },
    next: {
      Back: 'Back'
    }
  };

  clamp = function(value, min, max) {
    return Math.max(min, Math.min(max, value));
  };

  moodSlider = function(mood, opposed) {
    var moodW, opposedW;
    moodW = clamp(mood * 10, 3, 97);
    opposedW = clamp(opposed * 10, 3, 97);
    return "<slider style=\"width: 100px\" title=\"" + mood + " / " + opposed + "\">\n  <div class=\"bottom\" style=\"width: " + (Math.min(50 - moodW, 100 - moodW - opposedW)) + "px\"></div>\n  <div class=\"bottom mood\" style=\"width: " + moodW + "px\"></div>\n  <div class=\"top opposed\" style=\"width: " + opposedW + "px\"></div>\n</slider>";
  };

  skillSlider = function(skill) {
    return "<slider class=\"right\" title=\"" + skill + "\">\n  <div class=\"top bottom skill\" style=\"width: " + skill + "px\"></div>\n</slider>";
  };

  clothesDesc = {
    Sundress: 'wearing a skimpy floral sundress',
    Jeans: 'wearing skinny jeans and an x-backed teal blouse',
    Miniskirt: 'wearing a hip-hugging black miniskirt and low cut red blouse'
  };

  dayToTimeString = function(day) {
    var days, months, years;
    years = Math.floor(day / 365);
    months = Math.floor((day - years * 365) / 30);
    days = day - years * 365 - months * 30;
    if (years) {
      if (years > 1) {
        return years + " years";
      } else {
        return 'more than a year';
      }
    } else if (months) {
      if (months > 1) {
        return "about " + months + " months";
      } else {
        return 'more than a month';
      }
    } else {
      if (days > 1) {
        return days + " days";
      } else {
        return 'one day';
      }
    }
  };

}).call(this);

(function() {
  Object.assign(Data.events, {
    Intro: {
      text: function() {
        return "\"You're almost at your new home, slut.\"\n\nYou roll over in your cage, quickly running up against the bars when you try to stretch. You sit upright, drawing an appreciative chuckle from the man who addressed you at the sight of hay clinging to your nude breasts.\n\nThis is not how you expected your vacation to go. You'd planned on a nice relaxing drive down the coast, resting wherever fancy landed you, with no cares, plenty of time to see the sights, meet the strangers, get drunk at bars... And now here you are. Whoops.\n\nA " + options + " girl like you should have known better than to take a drink from a stranger.\n\n<em>You have " + (Object.keys(Game.skills).length) + " different possible skills, ranging from 0 to 100. Different events will offer you chances to raise them over time, and events will present options with various chances of success depending on your ratings.</em>\n\n<em>Almost all buttons in the game have title text - you can hover over them to see the mechanical effects of various choices.</em>";
      },
      next: {
        'Well Bred': 'IntroRich',
        'Suburban': 'IntroWelloff',
        'Working class': 'IntroWorking',
        'Street smart': 'IntroPoor'
      }
    },
    IntroRich: {
      text: function() {
        return "The man smiles as he unlocks the cell door and gestures you to come out. It's a proper barred prison cell, but with the hay to sleep on, you couldn't help but think of it as your cage.\n\n\"Lucky girl, you're going to see your new home today. The auction will begin in an hour, so plenty of time to get you cleaned up and ready. Fine piece of ass like you, no doubt you'll get a fine rich man to take care of you. Or woman. You like women, slut?\"\n\n\"I...\"\n\n\"Doesn't matter,\" he cuts you off. \"You'll fuck who you're told to, and you'll learn to enjoy it. Go on into the showers and get yourself cleaned up. You want to look nice for the buyers, and that's for your benefit as well as mine. You go for a high price, you get treated like a worthy prize, yes? You don't want to end up a street trash whore.\"\n\nYou were a normal woman, living your normal life... now you're for sale in an Anglani market. You'd never heard of Anglani before three days ago, when you glimpsed it on the arrival gate, disembarking from your airplane. How they'd arranged to have a squirming duffle bag pass through security back home was a mystery to you. When you got off the plane, you were in for another shock: slavery was legal here, and you were now property. The customs official explained it all very clearly - you can't be killed, that's still a crime, but anything short of that is at your owner's discretion. Your immigration form - filled out for you - didn't state a name. You aren't allowed a name until your master chooses one for you. And a slave trading company has no interesting in naming you - that's a privilage be for your new master.\n\nThat was two days ago. Everything since then has been a blur. Somehow you find you've managed to wash yourself - with that done, rough hands drape you in an elegant gown, do your hair, apply makeup and otherwise prepare you in a hurry, getting you ready to sell for the highest possible price. And, just like that, you find yourself stumbling onto the stage.\n\n\"Ladies and Gentlemen, our next piece of meat is a real prize, a genuine never owned free woman. And boy doesn't she look excellent tonight, you can just tell what a " + options + " girl she'll be.";
      },
      next: {
        Pretty: 'IntroPretty',
        Smart: 'IntroSmart',
        Hardworking: 'IntroHardworking'
      },
      effects: {
        skills: {
          Etiquette: 10,
          Fashion: 7,
          Literature: 5,
          Instruments: 3
        },
        set: {
          background: 'Rich'
        }
      }
    },
    IntroWelloff: {
      ext: 'IntroRich',
      effects: {
        skills: {
          Memorization: 10,
          Mathematics: 7,
          Makeup: 5,
          Baking: 3
        },
        set: {
          background: 'Well Off'
        }
      }
    },
    IntroWorking: {
      ext: 'IntroRich',
      effects: {
        skills: {
          Strength: 10,
          Cooking: 7,
          Flirting: 5,
          Endurance: 3
        },
        set: {
          background: 'Working Class'
        }
      }
    },
    IntroPoor: {
      ext: 'IntroRich',
      effects: {
        skills: {
          Endurance: 10,
          Climbing: 7,
          Medicine: 5,
          Intimidation: 3
        },
        set: {
          background: 'Poor'
        }
      }
    },
    IntroPretty: {
      title: 'Past careers depending on beauty',
      text: function() {
        return "\"I hear she was " + options + " in her old life, can you believe that? Keep her as one or mold her into something new, can't you just feel that pliable flesh in your hands... young and fresh and ripe for the plucking. She's not a virgin though, I can tell you that much.\" The lewd joke at your expense draws some laughter from the crowd, and some heat from your cheeks.";
      },
      next: {
        'An exotic dancer': 'IntroDancer',
        'An idol': 'IntroIdol',
        'A musician': 'IntroMusician',
        'A stripper': 'IntroStripper',
        'A whore': 'IntroWhore',
        'Something Else': 'Back'
      }
    },
    IntroSmart: {
      ext: 'IntroPretty',
      title: 'Past careers depending on brains',
      next: {
        'A college student': 'IntroStudent',
        'A doctor': 'IntroDoctor',
        'A librarian': 'IntroLibrarian',
        'A programmer': 'IntroProgrammer',
        'A scientist': 'IntroScientist',
        'A stock broker': 'IntroBroker',
        'Something Else': 'Back'
      }
    },
    IntroHardworking: {
      ext: 'IntroPretty',
      title: 'Past careers depending on brawn',
      next: {
        'An athlete': 'IntroAthlete',
        'A barista': 'IntroBarista',
        'A housewife': 'IntroHousewife',
        'A nun': 'IntroNun',
        'A soldier': 'IntroSoldier',
        'Something Else': 'Back'
      }
    },
    IntroDancer: {
      effects: {
        skills: {
          Flirting: 20,
          Seduction: 15,
          Immodesty: 10,
          Dancing: 5
        },
        set: {
          profession: 'Exotic Dancer'
        }
      },
      text: function() {
        return "The bidding starts slow, picking up as the announcer reminds them that you've never been a slave, and climbing up even more fiercely when you're stripped naked on stage. It's all a blur. You can't hear the numbers being shouted out. You can barely see the crowd, with so much bright light on the stage, but you manage to pick out some faces here and there. Most of the people present aren't bidding - they're just here to enjoy the show. That's you.\n\n\"Going once...\" With a start you realize you're about to be sold. To the hideous man in the far corner. Everyone's left him plenty of space. You imagine you can smell him from all the way up here. That's... that's not good. But he hesitated a long time before that last bid - one more and he'll probably be out of the running. You look desperately across the crowd, and finally see\n\n" + options + "\n\n<em>The master or mistress you choose will personally only appear in the game rarely, but this choice will also determine the sorts of random events you'll encounter - a cruel mistress will still send nice things your way now and then, but you can expect harder tasks and worse punishments.</em>";
      },
      next: {
        'Ms. Danni Jemson': 'IntroDanni',
        'Mr. Nick Romanov': 'IntroNick',
        'Ms. Sarah Lanshi': 'IntroSarah'
      }
    },
    IntroIdol: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Fashion: 20,
          Flirting: 15,
          Makeup: 10,
          Singing: 5
        },
        set: {
          profession: 'Idol'
        }
      }
    },
    IntroMusician: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Instruments: 20,
          Singing: 15,
          Concentration: 10,
          Fashion: 5
        },
        set: {
          profession: 'Musician'
        }
      }
    },
    IntroStripper: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Immodesty: 20,
          Flattery: 15,
          Seduction: 10,
          Dancing: 5
        },
        set: {
          profession: 'Stripper'
        }
      }
    },
    IntroWhore: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          'Gag Reflex': 20,
          Immodesty: 15,
          Anal: 10,
          Flirting: 5
        },
        set: {
          profession: 'Whore'
        }
      }
    },
    IntroStudent: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Memorization: 20,
          Bluffing: 15,
          Flirting: 10,
          Mathematics: 5
        },
        set: {
          profession: 'College Student'
        }
      }
    },
    IntroDoctor: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Medicine: 20,
          Concentration: 15,
          Temperance: 10,
          Endurance: 5
        },
        set: {
          profession: 'Doctor'
        }
      }
    },
    IntroLibrarian: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Literature: 20,
          Memorization: 15,
          Mathematics: 10,
          Concentration: 5
        },
        set: {
          profession: 'Librarian'
        }
      }
    },
    IntroProgrammer: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Concentration: 20,
          Memorization: 15,
          Mathematics: 10,
          Temperance: 5
        },
        set: {
          profession: 'Programmer'
        }
      }
    },
    IntroScientist: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Mathematics: 20,
          Memorization: 15,
          Concentration: 10,
          Literature: 5
        },
        set: {
          profession: 'Scientist'
        }
      }
    },
    IntroBroker: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Concentration: 20,
          Flattery: 15,
          Mathematics: 10,
          Etiquette: 5
        },
        set: {
          profession: 'Stock Broker'
        }
      }
    },
    IntroAthlete: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Endurance: 20,
          Strength: 15,
          Climbing: 10,
          Intimidation: 5
        },
        set: {
          profession: 'Athelete'
        }
      }
    },
    IntroBarista: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Temperance: 20,
          Flirting: 15,
          Cooking: 10,
          Makeup: 5
        },
        set: {
          profession: 'Barista'
        }
      }
    },
    IntroHousewife: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Cooking: 20,
          Baking: 15,
          Endurance: 10,
          Oral: 5
        },
        set: {
          profession: 'Housewife'
        }
      }
    },
    IntroNun: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Temperance: 20,
          Etiquette: 15,
          Literature: 10,
          Baking: 5
        },
        set: {
          profession: 'Nun'
        }
      }
    },
    IntroSoldier: {
      ext: 'IntroDancer',
      effects: {
        skills: {
          Strength: 20,
          Intimidation: 15,
          Endurance: 10,
          Temperance: 5
        },
        set: {
          profession: 'Soldier'
        }
      }
    },
    IntroDanni: {
      title: "Mistress Jemson is a kind woman - strict but fair, she wants what's best for her slaves and treats them well. Don't mistake her kindness for weakness, though.",
      effects: {
        set: {
          storyteller: 'danni'
        }
      },
      text: function() {
        return "You lock eyes with a young woman, hardly older than you but clearly used to command. Long dark curls roll past her shoulders, and when she sees the desperation in your gaze, there's an immediate reaction of sympathy. She bids.";
      },
      next: 'IntroHome'
    },
    IntroNick: {
      title: "Master Romanov enjoys fucking, and fucking slaves is his favorite. Expect to be used.",
      effects: {
        set: {
          storyteller: 'nick'
        }
      },
      text: function() {
        return "You catch the eye of an older man, with salt and pepper hair and a neatly trimmed beard. He smiles, a mixture of reassurance and sensuality, and raises his sign for a bid.";
      },
      next: 'IntroHome'
    },
    IntroSarah: {
      title: "Mistress Sarah enjoys suffering. Her ideal slave is obedient, submissive, and silent - and she'll apply pressure in that direction.",
      effects: {
        set: {
          storyteller: 'sarah'
        }
      },
      text: function() {
        return "You catch the eye of an older woman, and are rewarded by an electric thrill running up your spine. Even from across the room, she manages to make you feel like prey. She bids.";
      },
      next: 'IntroHome'
    },
    IntroHome: {
      text: function() {
        return " \"Going once... going twice... sold! Sold to one of our favorite customers. You can collect your merchandise out back, we'll have it ready for you as usual in a few minutes.\"\n\n It takes you a moment to realize that \"it\" refers to \"you,\" but your realization isn't necessary - hands hustle your naked body off stage so the auctioneer can get on with the rest of the night. That leaves you in the hands of a single guard. Briefly, you consider trying to escape -  you're not bound, and there's a whole crowd of people nearby you could try to get lost in, but you abandon the idea when you get a better look at the guard - he's at least a foot taller than you and seemingly made of muscle. He smirks when he sees you looking.\n\n \"Ready as usual\" turns out to involve a great deal of rope and cloth - cloth stuffed in your mouth holding your jaw open then wrapped around your head to hold it in place, more cloth around your eyes, and rope pulling your knees up to your chest and your arms folded along your sides. The whole procedure occurs without regard for your comfort or compliance, leaving you blind, mute and immobile, folded up like a little pill and abandoned on the floor, still naked.\n\n You hear people moving around, people talking about payment, and steps approaching. Suddenly a pair of fingers push themselves into your unprepared pussy. You'd yelp, were you able to make noise, but your startled reaction draws a chuckle anyway. The fingers probe around inside you for a moment before withdrawing.\n\n \"She's a hot little thing, isn't she?\"\n \"Mhm. The " + mistress + " will be pleased. See you at poker night?\"\n \"Of course.\"\n\n The purpose of the ropes - beyond making you helpless - becomes apparent as the place where they gather behind your back becomes a handle, the man lifting you up like a squirming duffle bag. They're not sure how much trouble you'd be left to your own devices, so they're taking no chances. You're carried outside, then into a van. Even if you couldn't see bits and pieces around your blindfold, the change in quality of the surrounding sounds would make that much obvious. The engine starts, and you're off.\n\n It's an uncomfortable ride. Face pressed up against the floor, it seems like you can feel every bump in the road. At least it doesn't last long - you can't be more than a few miles from the auction house when the van comes to a stop again.\n\n \"Welcome to your new home, slut.\" A shoe digs into your side - not unkindly, but enough to make sure you know you're the one being addressed. \"I'm going to remove your blindfold and gag now, and loosen most of the restraints. Feel free to scream. Most new slaves do, and it's best to get it out of your system before I open the door and everyone sees you. Wouldn't make a good first impression to be acting like a wild animal caught in a cage, now would it?\" He leans down so his voice is right in your ear. \"That is what you are though, a wild animal. Don't worry though, we'll tame you.\"\n\n\"I'm untying you now.\" He reaches down and begins to unwrap the gag. \"We'll put up with a lot, especially in your first few days. One thing we never tollerate is attacking any of the overseers or other slaves. Hurting people is my job, not yours.\"\n\n" + options + "\n\n<em>In addition to your skills, you have three mood bars, which fill up with different emotions. The first holds some combination of Humility and Pride, the second combines Hope and Despair, the third combines Spirit and Detachment. Each bar can hold up to ten points, distributed between the two emotions.</em>\n\n<em>Moods serve two purposes - they help you learn skills faster, and they can be spent to help pass skill tests. More on skill tests in a moment.</em>";
      },
      next: {
        'Bite him': 'IntroBite',
        'Panic': 'IntroPanic',
        'Retain your dignity': 'IntroDignity'
      }
    },
    IntroBite: {
      text: function() {
        return "Sicko. You nod to show you understand. Once the cloth is gone, you spit out the rag that was holding your jaw open and work it, biding your time while he removes the blindfold and works the knots to untie you. Your attack comes when he reaches down to caress your cheek - rather than the gentle gesture he expected to give, he gets your teeth sunk into his palm and fingers.\n\nHe doesn't yell, just backhands you across the face with his other arm, a brutal blow that still isn't enough to dislodge you. His follow up kick to your gut is, however, leaving you twisting on the floor gasping for breath while he cradles a bloody hand.\n\n\"I warned you, bitch. Now, we have some things to do right this second, but come tomorrow, or the day after, or the day after that... you'll regret it. We like to make people live in suspense about what exactly that means. You've just earned your first punishment.\" He kicks you again, and while you're still curled up in pain, rolls you over onto your face with his foot. He uses his one good hand to open the van door. \"Joel! A hand? Bitch bit me, right down to the bone.\"\n\nIt doesn't take long before Joel arrives to help carry you. You thrash a little, but it's not at all effective - now that they're keeping clear of your head, there's nothing you can do to stop him from throwing you over one shoulder like a sack of potatoes.";
      },
      next: 'IntroArrive',
      effects: {
        mood: {
          Pride: 3,
          Spirit: 3
        },
        set: {
          punishment: true
        }
      }
    },
    IntroPanic: {
      text: function() {
        return "It's all too much. His hand right by your head, the jerky ride, the shock of being told you're going to be a slave... you scream something obscene and incoherent at your captor, thrash around on the floor with wild eyes, and start to sob.\n\nYou half expected him to kick you, or perhaps drag you screaming across the yard, but the abuse never comes. Instead he sits on you long enough to pull out a knife and cut most of ropes holding you curled up, then sits behind you and pulls you upright in an irresistible hug. He doesn't speak, just holds you. You're terribly weak compared to him, but you do manage to conk him a good one in the eye with the back of your head in your panic.\n\nSlowly though, the gentle contact works its magic, and in spite of yourself, you find your body relaxing. He still doesn't say anything, just holding you comfortingly. Eventually he lets go, and with a handkerchief from one pocket, wipes off your face, an action welcome despite the indignity of having him do it for you.\n\n\"That's a good girl.\" He stands and opens the door, and after a moment looking around, \"Hey Joel! Come carry the new one in, I have to give my report.\"\n\nIt doesn't take long before Joel arrives to help carry you. All your fight is gone for now, your body exhausted, so you don't do anything to resist when he throws you over his shoulder like a sack of potatoes.";
      },
      next: 'IntroArrive',
      effects: {
        mood: {
          Spirit: 3,
          Despair: 3
        }
      }
    },
    IntroDignity: {
      text: function() {
        return "You nod your understanding. Tied up like this, there's not a whole lot you can do, and even if you did manage to get free, you're naked in a foreign country where everyone seems to accept slaves as the natural state of affairs. It wouldn't be long before you were caught and returned.\n\nWith your silent cooperation, it doesn't take him long to remove the gag and blindfold, and untie most of the ropes. Only most of them - your elbows and wrists are still tied together. He helps you to stand, but you're still weak from being immobile too long, and looking at your wobble, he sits you back down - still naked - on the floor.\n\n\"Hey Joel! Come carry the new one in. She's being good, but I have to give my report.\" It doesn't take long before Joel arrives to help carry you. He's rather gentle, scooping you up in a bridal carry.";
      },
      next: 'IntroArrive',
      effects: {
        mood: {
          Humility: 3,
          Despair: 3
        }
      }
    },
    IntroArrive: {
      text: function() {
        return "The afternoon light bites your eyes after so much darkness, making you squint and wish your arms were free so you could rub them. Lifting your head, you get your first look at your new home.\n\nIt's a mansion. A fabulous one, right out of a storybook. " + Ms + ". " + Masterson + " must be very wealthy indeed, as though you didn't already know that from the way " + she + " bought a new sex slave out from under a room full of eager bidders. A red tile roof and stone walls, dozens of rooms, a garage off to one side large enough for a dozen cars. The grounds are huge, and very well kept - multiple outbuildings, some of them large enough to be houses in their own right, are interspersed with gardens and an outdoor pool. You were wrong at first - it's not a mansion, it's a palace. Or at least it seems that way.\n\nThere are others working or walking around, but you don't get a chance to do more than glimpse their curious faces before Joel carries you into one of the outbuildings. It's a bedroom - or a dungeon? It has features of both. There's a soft bed, but stone walls with manacles hanging from them. A bathroom to one side, but also a hole in the ground and a hose coiled half out of sight beneath a stone bench.\n\nJoel drops you onto the bed, and before you can react, climbs on top of you, pinning you down with his bodyweight. Like most of the men you've seen so far, he's over six foot and with muscles to back it up, the sort that come from hard work rather than the gym. If he weren't about to rape you, he'd be almost handsome, with his chiseled face, chopped brown hair and rough hands... it takes a moment before you realize you're not about to be raped. He's just taking no chances as he finishes untying you.\n\n\"This'll be your new home for the next few days, while we get everything sorted. Someone will be by soon to speak with you.\" He climbs off and stands as soon as he's done, no lingering touches or other unnecessary contact.\n\nYou rub your wrists and look around. You're pretty sure it's a cell now, not a bedroom. He's handsome and he has power over you, but maybe you can get some more answers before he leaves you alone and naked in your cell.\n\n" + options + "\n\n<em>Here you have the option of several different skill tests. During a skill test, you roll 2d6 + (skill / 10, round down). If you meet the difficulty, you pass. Don't worry if you can't pass every skill check, especially at first - you'll usually get better at the skill even if you fail.</em>\n\n<em>During random events, which test you choose determines </em>what happens<em>, while pass/fail determines the </em>mechanical rewards<em>. You won't miss anything during random events (and the intro) by failing tests.</em>";
      },
      next: {
        'Be cute and scared': {
          skill: 'Seduction',
          diff: 6,
          result: ['IntroCuteYes', 'IntroCuteNo']
        },
        'Ask about clothes': {
          skill: 'Flirting',
          diff: 5,
          result: ['IntroClothesYes', 'IntroClothesNo']
        },
        'Glare at him': {
          skill: 'Intimidation',
          diff: 8,
          result: ['IntroGlareYes', 'IntroGlareNo']
        }
      }
    },
    IntroCuteYes: {
      text: function() {
        return "You bite your lip and glance at his face, then away again, hugging your arms across your chest. \"That's a long time to be alone...\"\n\nHe reaches out to put a hand on your shoulder, then seeming to remember how naked you are, pulls it back. \"It's not that bad. A chance to think things over and have some privacy. You won't get much of that anymore.\"\n\nYou smile shyly in his direction and turn on the bed, pulling your knees up to your chest. \"Do you have to go right now?\"\n\n\"I'm afraid I do. Work waits for no woman.\" He does put his hand on your shoulder this time, giving it a brief squeeze before standing. \"Don't worry, the " + mistress + " treats " + her + " slaves well.\" He's clearly not used to using that word yet, especially not with attractive naked women.\n\n\"You're not a slave?\"\n\n\"Nope, just a hired hand. " + She + " treats us pretty well too.\" He grins, pats your shoulder again and makes his exit.\n\nThe lock clicks. You're alone.";
      },
      effects: {
        skills: {
          Seduction: 1
        },
        mood: {
          Hope: 2
        }
      },
      next: 'IntroPlanDay'
    },
    IntroCuteNo: {
      ext: 'IntroCuteYes',
      effects: {
        skills: {
          Seduction: 1
        },
        mood: {
          Despair: 1
        }
      }
    },
    IntroClothesYes: {
      text: function() {
        return "\"Um... do I have to stay naked?\" You lower your arms and pull your knees up to your chin, giving him a brief flash of first your breasts and then your pussy before you turn to face the wall, back in his direction.\n\n\"That you do.\" It's obvious he's noticed your state of nakedness - not that he could have helped it carrying you few minutes ago then pinning you to the bed, but now you're calling attention to it, and he's blushing slightly. It's cute.\n\n\"It's a bit drafty in here...\"\n\n\"There's a thermostat in the corner. This isn't a punishment, just a... um... reminder of your new status. As a slave.\" He's not really used to using that word, it's clear, especially not with attractive women.\n\n\"You're not one?\"\n\n\"Nope, just a hired hand.\" He pats you on the shoulder and flees the scene. You may not have gotten any clothes - not that you were really expecting to - but you're pretty sure you've at least made an impression.\n\nThe lock clicks. You're alone.";
      },
      effects: {
        skills: {
          Flirting: 1
        },
        mood: {
          Spirit: 2
        }
      },
      next: 'IntroPlanDay'
    },
    IntroClothesNo: {
      ext: 'IntroClothesYes',
      effects: {
        skills: {
          Flirting: 1
        },
        mood: {
          Detachment: 1
        }
      }
    },
    IntroGlareYes: {
      text: function() {
        return "You stare at him. He looks at the floor. He's clearly not used to being in such proximity to naked women, especially not angry ones. \"Out.\"\n\n\"I'm not an overseer, but that doesn't mean I can't touch you if I want to.\" He grabs your wrists with one hand and hauls your arms up over your head, then smacks your breast with the other. It's more shocking than painful, a sudden reminder of just how at his mercy you are.\n\nSeeing your expression Joel seems to remember himself, and with an embarrassed, apologetic \"sorry,\" releases you and flees the scene.\n\nThe lock clicks. You're alone.";
      },
      effects: {
        skills: {
          Intimidation: 1
        },
        mood: {
          Pride: 2
        }
      },
      next: 'IntroPlanDay'
    },
    IntroGlareNo: {
      ext: 'IntroGlareYes',
      effects: {
        skills: {
          Intimidation: 1
        },
        mood: {
          Humility: 1
        }
      }
    }
  });

  Data.events.IntroPlanDay = {
    ext: 'PlanDay',
    text: function() {
      return (Data.events.PlanDay.text()) + "\n\n<em>Each day, you'll get to choose your activities for the morning, evening and night, as well as pick what you're going to wear (though right now, of course, you only have one option in that regard). Click on the task to change it, then Normal Day once you've set your schedule (there will be other options for how to spend your time later).</em>\n\n<em>For actions which increase your skills, you'll learn faster by having more of the associated mood - for example, Cooking +2 (Humility) means that the action will increase your cooking faster if you had more Humility (or slower if you have less of it).</em>";
    }
  };

  Data.adventures.IntroAdventure = {
    conditions: {
      day: [1, NaN]
    },
    description: 'Your new home',
    steps: ['ReleaseFromCell', 'Naming', 'Clothing', 'ClothingChoice']
  };

  Data.events.ReleaseFromCell = {
    description: 'The mansion',
    text: function() {
      return "You're woken from a sound sleep by a hush of air from the door opening. You stretch your arms up and rub your eyes, trying to make sense of your surroundings. Comfortable bed, stone walls, no clothes, a strange man watching you... you sit upright and pull the sheet up to cover your naked chest.\n\n\"Good morning, my nameless little whore. It's time to get you acquainted with the estate. I'd tell you to get dressed, but, well, you don't get to.\" He levels a crooked smile in your direction, and you decide that you don't much like the way he looks at you. Joel from yesterday was pleasant and blushing, and the head overseer whose name you didn't catch was direct and efficient, but really, you didn't find yourself worrying about either of them too much, even naked and at their complete mercy.\n\n\"Come on, get a move.\" He comes over to the edge of the bed and gives the sheet a tug. You hang onto it for a moment before sense takes over. He's going to get his way, one way or another, and you'd rather not give him an excuse to make \"his way\" into something worse than a tour and introductions. He tugs the sheet again and you let it fall, leering at your breasts as you squirm in discomfort.\n\nHe leads you out of your cell into the early morning light, your arms firmly crossed over your chest, providing the least possible bit of modesty. The two of you walk along a cobbled path towards the main mansion.\n\n\"" + Ms + " " + Masterson + " is a good owner - like most of the other sex slaves here, you'll have a lot more freedom than you might have expected. The four of you are here as decoration and fuck toys, not laborers. That's not an excuse for laziness, but you won't have someone leaning over your shoulder telling you what to do every minute. How you make yourself pleasing to us is your decision.\" He stops walking suddenly, and as you nearly run into him, he reaches down between your legs to grope you. Your hands slap him away reflexively, and he takes the chance to grab a breast and squeeze, before stepping back and giving you space again.\n\n\"There's one important duty you have though. Your body's available to anyone who wants it at any time. The " + mistress + ", me, the field hands, visitors from town - if they're on the estate, you're at their disposal sexually. Only overseers can give you non-sexual orders, though. That's me, Mr. Stevens, Ms. Wendy. We're also the only ones - other than the " + mistress + " of course - who can give you long-standing orders. Once you're out of sight of anyone else, you're free. Understand?\"\n\n\"Yes.\"\n\n\"Yes Sir. My first order - I'm always Sir to you. The other overseers don't care so much, but I like it. I want a sir at the end of everything you say to me.\" He pauses, waiting for you to answer.\n\n\"Yes... sir.\" Now doesn't seem the time to push.\n\n\"Very good. Now, I'm going to have some fun with you later, but first we need to visit the " + mistress + ". We can't keep calling you slut forever, it's not specific enough, since that could mean any woman in the room. Time to get your new name. Exciting, isn't it, slut?\"";
    },
    next: 'Naming'
  };

  Data.events.Naming = {
    description: 'A new name',
    text: function() {
      return "The two of you reach a small side door to the mansion, and he gestures you inside. The interior is all red carpet, polished wood, tasteful wealth and rows of doors with bronze placards. You don't have much of a chance to gawk though, since you're led immediately up a flight of stairs and through a pair of double doors into the master bedroom.\n\nIt can't be anything other than the master bedroom, given the combination of a king sized bed, an amazingly expensive looking computer setup in one corner currently showing rows of security cameras, and the " + woman + " lounging in bed reading. " + She + " looks up when the two of you enter, and suddenly you're completely conscious of your nudity again. You try to shrink back, but a hand pushes you forward.\n\n" + Mandy + " " + Masterson + ", your owner, the " + woman + " with almost complete power over your life, sizes you up. It's the first time you've seen " + her + " up close, and the first time " + she + "'s seen you except on stage.\n\n\"I'll name her...\" " + options;
    },
    next: {
      Natalie: 'setName',
      Jessie: 'setName',
      Slut: 'setName',
      Cunt: 'setName',
      Slave: 'setName',
      'Something else...': 'setName'
    }
  };

  Data.pseudoEvents.setName = function(name) {
    var newName;
    if (name === 'Something else...') {
      newName = window.prompt("I'll name her...");
      if (!newName) {
        return;
      }
      g.name = newName;
    } else {
      g.name = name;
    }
    return applyEvent('NamingDone', name);
  };

  Data.events.NamingDone = {
    text: function() {
      return "\"" + g.name + ". I hope you'll find your new life enjoyably and fulfilling. We'll speak again in a few days once you've had more of a chance to settle in.\"\n\nAnd just like that, you have a new name. " + g.name + ". You roll it around in your mind trying to figure out how to feel about it.\n\n" + options + "\n\n<em>An adventure is a series of events, each of which ends with a skill check. Unlike random events though, each option has the same result - pass, and you continue the adventure. Fail, and the adventure comes to a halt. You can resume partially completed adventures without penalty other than wasted time, so don't be afraid to scout out new situations when they appear.</em>\n";
    },
    next: {
      'Be polite': {
        skill: 'Etiquette',
        diff: 6,
        result: ['Clothing', 'NamingFail']
      },
      'Hide your feelings': {
        skill: 'Bluffing',
        diff: 7,
        result: ['Clothing', 'NamingFail']
      },
      'Be enthusiastic': {
        skill: 'Flattery',
        diff: 6,
        result: ['Clothing', 'NamingFail']
      }
    }
  };

  Data.events.NamingFail = {
    description: 'Pause adventure',
    text: function() {
      return "As you hesitate, " + she + " shakes " + her + " head.\n\n\"Hm, no, I'm not sure it fits her. Bring her back tomorrow, we'll see if I can think of something better then.\"\n\nLooks like it's another night in the cell for you. The overseer leads you back and locks you up again. Welp.";
    }
  };

  Data.events.Clothing = {
    description: 'Clothes',
    text: function() {
      return Ms + ". " + Masterson + " smiles at your words. With that little ritual taken care of, the overseer - you still haven't caught his name besides \"sir,\" and that's not a thing you want to call him to yourself - hurries you back out of " + her + " presence.\n\nHe leads you back down the stairway and into a walk-in closet right next to the manner door. It's large enough to serve as a changing room as well as a closet, with a vanity and mirror along the back wall. The hanging space is divided into several sections - Robin, Tanya, Tits, unlabeled.\n\n\"That's your section right there,\" he points to the unlabeled division. It's mostly empty right now, only three outfits compared to the dozen or so for each of the other slaves. \"Right next to Robin's clothes. You'll earn more options over time. There's another copy of this closet over on the opposite side of the mansion - use whichever's convenient. Shower's just on the other side of the hall. This drawer,\" he pats the vanity and leers, \"always has fresh panties, since you'll be soaking, losing, tearing off or otherwise ruining them rather frequently. Now, cute as it is to watch your little derriere bouncing along, that's a treat for special occasions. Time to get dressed.\"\n\nYou try to find something that " + options + "\n\n<em>On many adventure skill checks, you have the option to spend mood points to boost your roll, +2 per mood point spent. As the game goes on, you'll have to strike a balance between spending mood points to pass adventures versus stocking up on them to learn skills faster.</em>";
    },
    next: {
      'Looks sharp': {
        skill: 'Fashion',
        mood: 'Pride',
        diff: 6,
        result: ['ClothingChoice', 'ClothingFail']
      },
      'Flatters your figure': {
        skill: 'Seduction',
        mood: 'Spirit',
        diff: 7,
        result: ['ClothingChoice', 'ClothingFail']
      },
      'Matches your eyes': {
        skill: 'Makeup',
        mood: 'Detachment',
        diff: 6,
        result: ['ClothingChoice', 'ClothingFail']
      }
    }
  };

  Data.events.ClothingFail = {
    description: 'Pause adventure',
    text: function() {
      return "You can't really find anything that catches your interest, and after a few minutes,";
    }
  };

  Data.events.ClothingChoice = {
    description: 'Get clothing',
    text: function() {
      return "\"I'll get whatever you pick tailored, and get a few more similar outfits for each closet.\"\n\nBy this point you know better than to hope he'll let you dress in privacy, and you can feel his eyes on you while you wiggle into your new clothes. But it doesn't really matter - you're dressed in something resembling normal clothes, and that instantly allows you to recover some portion of the modesty, sense of control and self-esteem you've been so lacking in since this whole ordeal began. You breathe a sigh of relief.\n\n\"You know, I was going to give you a tour of the estate, but my enthusiasm has suddenly just dried up. Your room's on the third floor. You're currently confined to the manor house - don't go wandering, we'll know. And remember, anyone can fuck you whenever and however they want. You're everyone's slut.\"\n\nHe leaves. You're at loose ends.";
    },
    effects: {
      set: {
        confined: 'manor',
        availableClothes: {
          Miniskirt: true,
          Sundress: true,
          Jeans: true
        }
      }
    }
  };

  Data.jobs.Misbehave = {
    description: 'Misbehave',
    title: "Get into trouble, setting yourself up for punishment later.",
    time: 'Night',
    conditions: {
      misc: {
        confined: '!cell',
        punishment: false
      }
    },
    text: function() {
      return "Skulking around the mansion late at night, you decide to write down what you <em>really</em> think of one of the overseers. On the wall. With a sharpie.\n\nNo one catches you in the act, but as you scurry away you have a sinking suspicion that you're going to find yourself in trouble sometime soon.";
    },
    effects: {
      set: {
        punishment: true
      }
    }
  };

  Data.randomEvents.ContentFinished = {
    description: "That's all for now",
    conditions: {
      events: {
        OverseerCarWash: true,
        LesbianBootyCall: true,
        ContentFinished: false
      }
    },
    time: 'Night',
    text: function() {
      return "<em>You've now seen most of the content in the game so far. Sorry, it's a bit short as of yet, but a two week game jam isn't a ton of time to write a game engine from scratch and add content to it. I certainly intend to extend Maiden's Tale further in the future, and you can follow progress - and play my other games in the meantime - <a href=\"http://winds.blue\" target=\"_blank\">on my blog</a>.</em>\n\n<em>Feel free to continue exploring the mansion - there are a good number of rooms to discover, though none of them do much yet. Also try Misbehaving - there are three different punishments available, if you haven't seen them yet.</em>";
    }
  };

}).call(this);

(function() {
  Data.jobs.EscapeCell = {
    description: 'Attempt to escape',
    conditions: {
      misc: {
        confined: 'cell'
      }
    },
    time: 'Night',
    effects: {
      skills: {
        Lockpicking: 'Pride'
      }
    },
    text: function() {
      return "You spend a few minutes wandering around your cell searching for something you can use as a lockpick, and eventually you settle for " + (g.events.EscapeYes ? 'your old standby, a partially straightened bedspring' : 'ripping open the underside of the boxspring (thank goodness they were nice enough to give you one of those) and partially straightening one of the metal bits') + ". With a great deal of patience you manage to bend one of the wires repeatedly in the same place until it snaps from fatigue. \"Lockpick\" is really a bit of a misnomer - what you manage is closer to the old trick with a credit card, unlatching the door by sliding your metal piece around in just the proper way. Good thing the door isn't really set of for holding a prisoner.\n\nYou poke your head out into the chill night air. Naked as you are, it doesn't really seem all that prudent to be wandering around outside, and even late at night there seem to be enough people around that you'd be caught and brought back in short order. Even so, knowing that you <em>could</em> get out if you really wanted to buoys your spirits.";
    }
  };

  Data.jobs.WaitCell = {
    description: 'Wait patiently',
    conditions: {
      misc: {
        confined: 'cell'
      }
    },
    time: 'Any',
    effects: {
      skills: {
        Temperance: 'Humility'
      }
    },
    text: function() {
      return "You've been locked up. Really... it's not so bad, is it? You get to spend some time alone, think about your life, try to come to terms with it... it would probably be a bit more relaxing if you weren't, you know, <em>locked in a cell</em>, but at least it's clean and dry. You try to make the best of it - that's the only way you're going to stay sane in your new life as a slave.";
    }
  };

  Data.jobs.Meditate = {
    description: 'Meditate',
    time: 'Any',
    effects: {
      skills: {
        Concentration: 'Spirit'
      }
    },
    text: function() {
      return "You sit on your bed, legs crossed and eyes closed, attempting to be as present as possible. You reassure yourself that the past and the future don't need your attention right now. You notice your breath, feel the sensations as air flows in and out of your body. Breathing is relaxing and fluid. Listen carefully to the environment around you, content merely to observe...\n\nYou stand up, stretch, shake your whole body to restore the habit of motion. A good way to spend a few hours.";
    }
  };

  Data.jobs.Exercise = {
    description: 'Exercise',
    time: 'Morning',
    effects: {
      skills: {
        Strength: 'Pride'
      }
    },
    text: function() {
      return "It doesn't take much space at all to work up a sweat - jumping jacks, crunches, a couple of stretches... you spend a few hours getting yourself all nice and glowing. It's lucky you don't have huge breasts to get in the way of your workout - even when they're wearing bras, you don't envy those women. Jiggle-jiggle. Your breasts make nice attractive little motions, but don't get in the way or swing around dangerously.";
    }
  };

}).call(this);

(function() {
  Data.jobs.ChangeMood = {
    description: 'Clear your mind',
    title: 'Trade points between moods (Pride <-> Humility, Hope <-> Despair, Spirit <-> Detachment)',
    time: 'Any',
    text: function() {
      return "Taking some time for yourself, you...\n\n" + options;
    },
    next: {
      'Contemplate your situtation': 'ReducePride',
      'Get angry': 'ReduceHumility',
      Cry: 'ReduceHope',
      'Cry silently': 'ReduceDespair',
      Nap: 'ReduceSpirit',
      'Search for motivation': 'ReduceDetachment',
      'Search for motivation': 'ReduceNothing'
    }
  };

  Object.assign(Data.events, {
    ReducePride: {
      conditions: {
        mood: {
          Pride: [2, 10]
        }
      },
      effects: {
        mood: {
          Pride: -2,
          Humility: 1
        }
      },
      text: function() {
        return "You're a slave. Really, it'd probably be better if you accepted the fact that these people have complete control over your life. Even if you escaped from them, you'd still be in a foreign country, with no money, no friends, and your face on a wanted poster. Whatever your eventual plans... for now, it'd be better not to antagonize them <em>too</em> much.";
      }
    },
    ReduceHumility: {
      conditions: {
        mood: {
          Humility: [2, 10]
        }
      },
      effects: {
        mood: {
          Humility: -2,
          Pride: 1
        }
      },
      text: function() {
        return "Fuck this. You may be in a foreign country, legally property without a penny to your name, but you're still a person, and while you'll obey some orders (your " + Mistress + " does have complete control over your body, and your body can <em>hurt</em>), there's no reason you have to give up independence of thought as well. Whatever your plans, it'd be better to retain some independence of thought and action.";
      }
    },
    ReduceHope: {
      conditions: {
        mood: {
          Hope: [2, 10]
        }
      },
      effects: {
        mood: {
          Hope: -2,
          Despair: 1
        }
      },
      text: function() {
        return "Taken away from your home and enslaved, humiliated, stripped naked, brutalized and generally completely out of control... you break down. It's not pretty, and you try to spare yourself the indignity of remembering too much, but it's a couple of hours before you manage to pull yourself together again.\n\nYou clean yourself up a little, splashing water over a tear-stained face. Fuck. Life is not looking up right now.";
      }
    },
    ReduceDespair: {
      conditions: {
        mood: {
          Despair: [2, 10]
        }
      },
      ext: 'ReduceHope',
      effects: {
        mood: {
          Despair: -2,
          Hope: 1
        }
      }
    },
    ReduceSpirit: {
      conditions: {
        mood: {
          Spirit: [2, 10]
        }
      },
      effects: {
        mood: {
          Spirit: -2,
          Detachment: 1
        }
      },
      text: function() {
        return "So much has happened the last few days that you deserve a bit of rest. Curling up on your bed, you drift off, planning to just rest your eyes for a few minutes.\n\nA few hours later, you rub the sleep from your eyes and yawn. Whelp. There goes the " + time + ".";
      }
    },
    ReduceDetachment: {
      conditions: {
        mood: {
          Detachment: [2, 10]
        }
      },
      effects: {
        mood: {
          Detachment: -2,
          Spirit: 1
        }
      },
      text: function() {
        return "So what if you're a slave? That's no excuse to laze around all day and wait for things to happen. You're lucky enough to have a good amount of freedom (within the confines set by your " + Mistress + "), so it's time to get up and use it!\n\nYou spend a few hours trying to stir up some motivation. It doesn't actually accomplish anything, but it might help you accomplish something later. You hope.";
      }
    },
    ReduceNothing: {
      conditions: {
        mood: {
          Pride: [0, 1],
          Humility: [0, 1],
          Hope: [0, 1],
          Despair: [0, 1],
          Spirit: [0, 1],
          Detachment: [0, 1]
        }
      },
      effects: {
        mood: {
          Spirit: 1
        }
      },
      text: function() {
        return "So what if you're a slave? That's no excuse to laze around all day and wait for things to happen. You're lucky enough to have a good amount of freedom (within the confines set by your " + Mistress + "), so it's time to get up and use it!\n\nYou spend a few hours trying to stir up some motivation. It doesn't actually accomplish anything, but it might help you accomplish something later. You hope.";
      }
    }
  });

}).call(this);

(function() {
  Data.jobs.ExploreMansion = {
    description: 'Explore the mansion',
    time: 'Evening',
    conditions: {
      misc: {
        confined: '!cell'
      }
    },
    effects: {
      skills: {
        Memorization: 'Despair'
      }
    },
    selectNext: 'random',
    next: ['ExploreNothing', 'ExplorePool', 'ExploreKitchen', 'ExploreCloset', 'ExploreLibrary', 'ExploreRecordingStudio', 'ExploreStevensRoom', 'ExploreSexToys']
  };

  Data.events.ExploreNothing = {
    description: 'Explore the mansion',
    text: function() {
      return "You wander around a bit, poking your head into various rooms, but don't manage to find anything interesting. All places you've been before, locked doors and sound coming from inside rooms you don't feel like interrupting lest you be required to join in and lose the rest of your day as someone's entertainment.";
    }
  };

  Data.events.ExplorePool = {
    description: 'Explore the mansion',
    conditions: {
      events: {
        ExplorePool: false
      }
    },
    text: function() {
      return "You've discovered... a pool. Why did no one tell you there was an indoor pool? It took a bit of finding - the thing is underground, no windows and an unmarked door. The lack of windows is an intentional part of the effect - blue and green light undulates slowly across the ceiling, giving the whole room the effect of being underwater. Pale blue tiles in rippling patterns slope downward into the water - there's no hard edge to the pool, just a steady slope down towards the deep end. No one's here at the moment, but there's a rack of fresh white towels at each side waiting use.\n\nYou take note. It's a beautiful place, very relaxing. Even if not going for a swim you might like to spend some time here.";
    }
  };

  Data.events.ExploreKitchen = {
    description: 'Explore the mansion',
    conditions: {
      events: {
        ExploreKitchen: false
      }
    },
    text: function() {
      return "You found the kitchen. That's great. What's less great is being chased around by an angry woman with a ladle. Hiding in an alcove along one of the hallways, you hear pounding steps. Oh god, she's found you again.\n\nSomeday you'll have to try visiting without sticking your fingers in a bowl of delicious and beautifully decorated pudding. Totally worth it. You break cover and flee.";
    }
  };

  Data.events.ExploreCloset = {
    description: 'Explore the mansion',
    conditions: {
      events: {
        ExploreCloset: false
      }
    },
    text: function() {
      return "In addition to the normal closets set aside for your use at any time of day or night (it's rather embarrassing, how many pairs of panties you've ruined or lost since coming here), you've found the storage room.\n\nIt's huge. You don't dare take anything out of it - you're not allowed more than the outfits the overseers have chosen to give you - but given how empty it is, you doubt anyone would mind if you spent a few hours... practicing. Yes, that's what you'll be doing. Definitely not drooling, that would be undignified. You can totally... practice... with that fur coat over there. Or even better, baggy jeans and a tshirt. You didn't think this country <i>made</i> clothes that didn't highlight a woman's sexuality.";
    }
  };

  Data.events.ExploreLibrary = {
    description: 'Explore the mansion',
    conditions: {
      events: {
        ExploreLibrary: false
      }
    },
    text: function() {
      return "The library, oddly enough, is not very extensive. Oh, sure, when you stumble across a room filled floor to ceiling with books it's more than <i>you've</i> ever owned, but compared to the decadence displayed everywhere else in the mansion, one room tucked away in a corner of the fourth floor is hardly what you'd expected.\n\nStill, books. It seems well enough used - no dust to be found - but you can probably squirrel yourself up in one of those comfy overstuffed chairs and do some reading, if you like. Or study, if that's your thing. Or at take a nap.";
    }
  };

  Data.events.ExploreRecordingStudio = {
    description: 'Explore the mansion',
    conditions: {
      events: {
        ExploreRecordingStudio: false
      }
    },
    text: function() {
      return "There's a recording studio. Of course there's a recording studio. It's not big, just enough for a couple of chairs, but it's soundproof, full of high quality electronics, and there's a closet full of beat up old instruments and songbooks. It must double as a practice room as well.\n\nThe place doesn't feel like it gets that much use, so it's probably safe to borrow it whenever you like. The worst they can do is... well, no, you don't want to think about the worst they can do to you. The worst they're <i>likely</i> to do is kick you out.";
    }
  };

  Data.events.ExploreStevensRoom = {
    description: 'Explore the mansion',
    conditions: {
      events: {
        ExploreStevensRoom: false
      }
    },
    text: function() {
      return "You stumble across a great secret - Mr. Stevens' room. Well, it's probably not actually a secret - there is a sign on the door after all - but it feels like one. You stand there staring at the door dumbly for a moment before it opens.\n\nMr. Stevens is as surprised to see you as you are to see him. He blinks, then steps back into his room, gesturing you to follow.\n\nHe's decorated it much like you expected, from what little you know of him. There's a fireplace in one wall, with a huge leather chair facing it, flanked by bookshelves. The speckled grey and black tiled floor matches his mustache. His bed is spacious, neatly made. Everything is perfectly in its place.\n\n\"" + g.name + ". Why are you here?\"\n\nYou take a moment to formulate a response that won't get you punished - you haven't done anything wrong, you know that, but you want to be sure he knows it too. \"I didn't know your room was here, I was just passing by.\"\n\nHe frowns. Not, it takes you a moment to realize, at the content of your words - he's frowning at your slouching stance. \"You look like a slob, and like a free woman. Please return another evening and we'll see what we can do to fix that. But for now just go away. I'm busy.\"\n\nYou flee.";
    }
  };

  Data.events.ExploreSexToys = {
    description: 'Explore the mansion',
    conditions: {
      events: {
        ExploreSexToys: false
      }
    },
    text: function() {
      return "While you do get fucked a lot, sometimes it would be nice to take your time, go at your own pace... or maybe practice deep-throating things so you don't feel so much like throwing up next time someone skullfucks you.\n\nThere are sex toys everywhere in this building. Like, you can't open a closet without finding a pair of vibrating dildos and a butt plug and maybe a blindfold. The trouble, though, is finding a place to use them in private, where the sounds you make won't draw someone wanting to take advantage of you.\n\nBut! You've just found a spot, a nice little balcony on the second floor (so no one inside can hear you) sheltered by trees (so no one outside can see you). And, of course, there's a chest full of naughty objects just waiting for use. Because going fifteen feet inside to fetch... a squirt gun filled with lube and a vibrator with a smiley face?... might ruin the mood. You close the chest again and try not to think about who decided to put it there.";
    }
  };

}).call(this);

(function() {
  Data.randomEvents.PunishmentMorning = {
    time: 'Morning',
    conditions: {
      misc: {
        punishment: true
      }
    },
    text: function() {
      return "They come for you midmorning, a polite knock on the door before they open it without waiting for you to respond. They, in this case, are a plump woman with beautiful golden waves of hair down her back and pursed lips, accompanied by a man who looks whispy, but has an iron grip when he catches one of your wrists. Caught off guard by the sudden motion, snick-snick, he cuffs your hands behind your back before it even occurs to you that resistance is possible.\n\n\"Come along, " + name + ". Time for your punishment.\" The woman doesn't seem unfriendly, but neither is she sympathetic - for you it may a traumatic experience, but for her it's just part of her job. \"You know what you've done.\"\n\nThe man, though, smiles at your discomfiture as he leads you out of the room and across the grounds. The destination is a squat building, one you " + (g.events.PunishmentMachine ? "haven't seen used before" : "haven't been to often") + ". The heavy wooden deer clicks closed behind the three of you ominously. There are no windows.\n\nYou're left in the dark a moment while the woman fumbles to find the light switch. \"Damn it Sorley, hold the door open while I find this damn thing.\"\n\nSorley just gives you a little shove in the shoulder, enough to remind you that he's there without moving you, his other hand on your wrists, still cuffed together behind your back. You're pretty sure you can feel him smirking.\n\nThe woman finally finds the light, revealing the room you've been brought to. Since it was a punishment, you were expecting grey stone walls and a concrete floor, but instead it looks more like a luxurious sitting room, with lush red carpet and black leather couches just begging to be sat un.\n\nYou don't get to sit on them, of course - as soon as you see it, you're certain what's about to happen next. The centerpiece of the room is a " + options + ".";
    },
    effects: {
      set: {
        punishment: false
      }
    },
    next: {
      'Metal contraption': {
        skill: 'Endurance',
        diff: 12,
        result: ['PunishMachineYes', 'PunishMachineNo']
      }
    }
  };

  Data.events.PunishMachineYes = {
    text: function() {
      return "With brisk efficiency the man removes your clothing, cutting away your top so he doesn't have to free your hands, then shoves you onto the seat. Two pairs of hands, one rough and one gentle, strap your ankles in securely, then pass belts across your hips, stomach, chest, and around your forehead. Finally they free your hands - but only for a moment, enough time to strap down your wrists as well.\n\nNaked, spread eagle, helpless... Sorley runs his hands along your inner thighs, cupping your sex with one hand and thrusting a finger in roughly. This draws a disapproving sound from the woman, but he doesn't seem to care.\n\n\"Like that, bitch? Well too bad, I'm not giving you my cock today. You get the machine instead.\" He removes his finger and begins adjusting the fucking machine, oblivious to - or perhaps enjoying - the woman's silent eye roll. Exasperation, not sympathy. She doesn't seem to care about you at all.\n\nYou can't raise your head to see what's happening, but you feel a silicone head pressing against your pussy. Sorley adjusts it a little more, then smears a big glob of cold goop over your crotch. A switch is flicked. The dildo pushes slowly into you. First just the tip, slowly, then it withdraws. A moment later it slides into you again, easier this time, and further. Slowly, back and forth, it explores into your depths. Despite the indignity of the situation, you feel yourself getting wet. It does feel nice, a slow, steady fucking, not too deep, not too hard... nervously you wonder when the punishment is going to begin.\n\n\"Ok, I think we're done here.\" It's the woman, sounding bored. \"See you in a few hours, " + name + ".\"\n\n\"Wait, are you just going to...\"\n\nThe sound of the closing door cuts you off. Yes, apparently they are just going to leave you here. Fuck. It feels good right now, but given a few hours of relentless pounding... constant stimulation becomes pure torture soon enough.\n\nThump, thump, thump. Good god your cunt is going to hurt. You won't be sitting right for days.";
    },
    effects: {
      skills: {
        Endurance: 1
      },
      mood: {
        Pride: 1
      }
    }
  };

  Data.events.PunishMachineNo = {
    ext: 'PunishMachineYes',
    effects: {
      skills: {
        Endurance: 1
      }
    }
  };

  Data.randomEvents.PunishNight = {
    time: 'Night',
    conditions: {
      misc: {
        punishment: true
      }
    },
    text: function() {
      return "They come for you in the middle of the night, and your first sign that anything's happening is a sudden grip on your shoulders, pulling you up and rousing you from your sleep. Someone yanks a bag over your head before you can do more than shout in surprise, drawstring pulling tight around your neck. You try to raise your hands to pull it off, but strong hands grab each wrist and pull them together over your head, hauling you painfully upright and out of bed.\n\nYou nearly panic as you realize they're going to " + options + " you.";
    },
    effects: {
      set: {
        punishment: false
      }
    },
    next: {
      'Gang Rape': {
        skill: 'Anal',
        diff: 12,
        result: ['PunishRapeYes', 'PunishRapeNo']
      }
    }
  };

  Data.events.PunishRapeYes = {
    text: function() {
      return "There are at least three of them, and you're still groggy with sleep - it takes scant  moments for them to cut off any hope of resistance, tieing your wrists together with what you'd guess is a tshirt and hanging them up on a conveniently placed wall hook. Convenient for them - there's nothing convenient for you about being blind, naked, wrists holding you up painfully so far you can only barely touch the ground with your toes if you strain.\n\nYou're still groggy with a horrible mix of sleep and adrenaline when they start raping you. You're a kidnapped sex slave. You've been imagining what this'll be like from the moment you arrived. It is, however, worse than you imagined. You're still dry as the first dick thrusts roughly into you, and you scream futilely into the bag over your head. He pulls out after just one thrust.\n\n\"Pass the lube, will you? Bitch is sandpaper.\" It's not your discomfort they care about - it's like they hardly even heard your scream. A hand covered with cold liquid gropes you, getting you ready for the return of his cock. Even with the lube it still hurts when he re-enters you.\n\nThey leave you exhausted, hurting, and " + options;
    },
    effects: {
      mood: {
        Hope: -1,
        Despair: 2
      }
    },
    next: {
      Terrified: 'PunishRapeTerrified',
      Broken: 'PunishRapeBroken'
    }
  };

  Data.events.PunishRapeNo = {
    ext: 'PunishRapeYes',
    effects: {
      mood: {
        Hope: -2,
        Despair: 1
      }
    }
  };

  Data.events.PunishRapeTerrified = {
    effects: {
      mood: {
        Humility: 1
      }
    },
    text: function() {
      return "By the time they're finally done with you and unhooking your hands, you can hardly stand. You stumble blindly, scraping a knee, one more pain to add to all the rest. Hands grab your wrists again, and after a moment they're free - you scrabble at the bag still over your head until a man's hands remove that as well. Wild-eyed, you look around at the men who've just finished violating you - only one is left in the room, but you scramble into the corner as far away from him as you can get.\n\nHe shakes his head and leaves. You're alone again. You shiver and sob and hug your knees.";
    }
  };

  Data.events.PunishRapeBroken = {
    effects: {
      mood: {
        Despair: 1
      }
    },
    text: function() {
      return "When they finally let your hands down, you can't do anything but curl up in a ball on the floor, shaking and traumatized. You moan a bit when one of them grabs your wrists, but he's just releasing the tie holding them together. This is not what you imagined it would be like. You feel powerless and helpless and a thousand other varieties of \"less.\"\n\nHe takes the bag off your head and leaves. You barely react, laying on the floor in your misery.";
    }
  };

}).call(this);

(function() {
  Data.randomEvents.LesbianBootyCall = {
    description: "Lesbian Booty Call",
    time: 'Morning',
    conditions: {
      misc: {
        confined: 'manor'
      }
    },
    text: function() {
      return "You're interrupted midafternoon by a polite knock on your door. Unusual - you're near the bottom of the totem pole around here, so even the other slaves usually just open the door on you. Grateful for the respect being shown, you set down your task and answer it quickly. In the doorway stands another slave named Robin, naked, glancing around furtively. You take the hint and invite her in.\n\n\"I, uh, I really want to eat you out. Like, right now.\"\n\nYou blink a few times. \"Why's that?\" It's not every day a cute redhead knocks on your door desperate to please you. She's both very cute and fire-hydrant red. The smell of female arousal and a faint buzzing follow her in to your room.\n\n\"I... um... I didn't please " + (she() === 'she' ? 'the Mistress' : 'one of the overseers') + ", and she thinks I need more practice with women. I'm not allowed to cum except when I get a woman off, and she won't... w-won't turn the vibrator off...\"\n\n" + options;
    },
    next: {
      'Grin and say no': 'LesbianBootyCallDenial',
      'Torment her more': 'LesbianBootyCallTorment',
      'Help her out': 'LesbianBootyCallYes'
    }
  };

  Data.events.LesbianBootyCallDenial = {
    effects: {
      mood: {
        Spirit: 1
      }
    },
    text: function() {
      return "You grin, drawing the moment out. \"No.\"\n\n\"P-please? It's driving me crazy, why not?\"\n\n\"You look so cute like this!\" You reach out and tweak a nipple, causing her to moan. \"Come back tomorrow and I'll consider it.\"\n\nRobin looks at you with desperation, getting even more turned on by your flat refusal. You enjoy the sight of juices running down her thighs as she runs out of your room to continue her search. Maybe she'll find some other woman to satisfy her needs before she explodes and earns herself another punishment... but you doubt it.";
    }
  };

  Data.events.LesbianBootyCallTorment = {
    effects: {
      mood: {
        Pride: 1
      }
    },
    text: function() {
      return "\"Down on your knees.\"\n\nRobin obeys instantly, and offers her spreads her legs eagerly when you nudge them apart. She moans eagerly as you move to the closet and fetch some items. Sexual implements are available in virtually any room of the mansion, a fact which usually works to your disadvantage, but right now is quite pleasant. \"How may I please you?\"\n\nYou don't answer, only return to stand in front of her. Gently you place harsh metal over her tender pink buds, eliciting a sharp intake of breath for each one. She doesn't flinch though, for which you reward her with a pat on the head. You finish her off with a blindfold.\n\n\"Good Robin. Now, I have some things to do before you interrupted, so you'll have to wait for me to finish. If you stay still like that for...\" you glance at the clock, \"ten minutes, I'll let you get me off.\"\n\nShe nods. You smile and pat her head again, and return to your work.\n\nRobin is indeed obedient. It's wonderfully distracting to have her kneeling at your feet, naked and dripping which a light buzz continues to emanate from her pussy.\n\nYou let her stew there for nine minutes - not quite the ten you promised - before finally setting down your work again. She perks up instantly as you move in her direction.\n\n" + options;
    },
    next: {
      'Get her off': 'LesbianBootyCallTormentYes',
      'Nope': 'LesbianBootyCallTormentNo'
    }
  };

  Data.events.LesbianBootyCallTormentNo = {
    text: function() {
      return "Grabbing both nipple clamps, you yank them off.\n\n\"Ahhh!\" She yelps and jerks forward at the intense pain, bringing her hands forward so she doesn't fall all the way over.\n\n\"That wasn't ten minutes, Robin.\" You remove the blindfold and wag your finger at her. \"I'm afraid you'll have to find someone else, since you couldn't obey me.\"\n\nShe hics, and looks at you with (entirely justified) betrayal. \"I... um... owwww...\" she staggers to her knees, the start of tears forming in her eyes.\n\nYou catch her and plant a kiss on her head before she can run out. \"You are a very sexy girl, and it's just so hot to see you like this.\"\n\nShe flees, each step sending droplets of her arousal flying. She may not like you much right now, but there's absolutely no doubt of how hot she's getting.";
    }
  };

  Data.events.LesbianBootyCallTormentYes = {
    text: function() {
      return "You strip down to your bare flesh, making her wait, and position your own pussy, now damp of its own accord, just in front of her. \"It hasn't been ten minutes yet,\" you caution her as you remove the nipple clamps - those draw gasps but no flinching - and her blindfold.\n\nShe tries to look up at you without inclining her head, but close as you are, quickly drops her eyes back to your crotch, inches away from her face. She makes a little noise of desperation, and inhales deeply.\n\nYou glance at the clock. A few seconds left. Fuck it, you're horny, and she's horny, and there's nothing stopping your from grabbing her face and shoving it into your crotch. She takes it as permission to move, and brings her hands up to grip your thighs. Robin's eager tongue flicks across your folds, and you tighten your grip in her short bob of shocking red hair, pressing her closer against you.";
    },
    next: 'LesbianBootyCallCleanup'
  };

  Data.events.LesbianBootyCallCleanup = {
    text: function() {
      return "Her desperation and eager submission don't leave you much choice - you hardly last more than a minute before a flick of your clit pushes you over the edge. She grunts in pain as your grip in her hair tightens even further, and your spasms smear your juices all over her face.\n\nRobin doesn't stop working with her tongue, as she eagerly rubs her own pussy. She too cums almost instantly, falling back on one hand and frigging herself furiously while the two of you moan and pant together.\n\nYou sit down beside her and pull her in for a kiss. It's no longer urgent, but still erotic, with your own taste clear in her mouth. She rubs her hands along your sides, gently enjoying your presence now that her immediate need has been satisfied. There's still the gentle buzzing coming from her ongoing torment with a vibrator, but it no longer controls her actions and she's content to spend a few minutes resting in your arms.";
    }
  };

  Data.events.LesbianBootyCallYes = {
    effects: {
      mood: {
        Hope: 1
      }
    },
    text: function() {
      return "\"Kneel down.\" You order her, and Robin eagerly obeys. She puts her hands on her thighs and fidgets while you strip down to your bare flesh and position your own pussy - starting to feel warm from her scent - just in front of her.\n\nShe stares at it longingly, licking her lips before looking up at you for permission.\n\nYou nod.\n\nRobin brings her hands up to grip your thighs, and her eager tongue flicks across your folds. You grip her short bob of shocking red hair, pressing her face deeper into your mound.";
    },
    next: 'LesbianBootyCallCleanup'
  };

  Data.randomEvents.OverseerCarWash = {
    description: "Car Wash",
    time: 'Morning',
    conditions: {
      misc: {
        confined: 'manor'
      }
    },
    text: function() {
      return "\"" + g.name + ". I have a job for you.\" Wendy - one of the overseers - just burst in on you.\n\nYou set down the hairbrush and stand, reaching for your " + (g.Clothes.toLowerCase()) + " to finish getting dressed.\n\n\"No, undies are fine. Come on, I haven't got all day.\" She leads you out of your " + (g.confined === 'cell' ? 'cell' : 'room') + " and to the entrance of the mansion. You mince your steps as you try not to hurt your bare feet, and whenever she's not looking, cover yourself with your hands as best you can.\n\nYour destination is a car - red, sporty, mud splashed on the wheels and undercarriage. \"Wash it.\"\n\nThe day is sunny and warm, so being outside in your skivies isn't too uncomfortable... or it wouldn't be if Wendy weren't watching you intently. She sits in the shade under a nearby tree as you gather bucket, suds, a hose...\n" + options;
    },
    next: {
      'Do your best': {
        skill: 'Immodesty',
        diff: 10,
        result: ['OverseerCarWashTryYes', 'OverseerCarWashTryNo']
      },
      'Fish for punishment': 'OverseerCarWashPunishment'
    }
  };

  Data.events.OverseerCarWashTryYes = {
    effects: {
      mood: {
        Pride: 2
      },
      skills: {
        Immodesty: 1
      }
    },
    text: function() {
      return "You do your blushing best to actually get the thing clean, acutely aware of the way Wendy's eyes rove over you. You have no choice but to wiggle your butt in her direction as you bend over the hood to wash the windshield, and you can feel her gaze on your breasts, jiggling as you scrub down the rims.\n\nShe sips on lemonade and watches, but doesn't molest you while you work. Thank goodness for small blessings. You're done early enough in the morning that there's still time for the rest of your plans - and she even shared some of her lemonade with you, since you did such a good job.";
    }
  };

  Data.events.OverseerCarWashTryNo = {
    ext: 'OverseerCarWashTryYes',
    effects: {
      mood: {
        Pride: 1
      },
      skills: {
        Immodesty: 1
      }
    }
  };

  Data.events.OverseerCarWashPunishment = {
    effects: {
      mood: {
        Spirit: 1
      },
      skills: {
        Flirting: 1
      }
    },
    text: function() {
      return "You start off using the sponge, but soon transition to using your breasts, rubbing them in sudsy circles on the hood of the car, bending over and wiggling your ass in Wendy's direction. You do your flirty best to both attract attention, and at the same time accomplish basically nothing as far as removing dirt from her vehicle.\n\nYou succeed on both accounts. Sitting in the shade and sipping her lemonade, Wendy can't take her eyes off you, and it isn't until nearly half an hour has passed that she remembers you're supposed to be cleaning, not giving her a sexy, soap-covered show.\n\n\"Dammit, I have to get going. Wash the soap off, you can finish some other time.\" Though she's trying to scowl, you can tell she doesn't really mean it. Also, she's a little flushed, and not just from the sun.\n\nMission accomplished.";
    }
  };

}).call(this);

(function() {
  window.mistress = function() {
    if (Data.storytellers[g.storyteller].gender === 'f') {
      return 'mistress';
    } else {
      return 'master';
    }
  };

  window.Mistress = function() {
    if (Data.storytellers[g.storyteller].gender === 'f') {
      return 'Mistress';
    } else {
      return 'Master';
    }
  };

  window.Mandy = function() {
    return Data.storytellers[g.storyteller].first;
  };

  window.Masterson = function() {
    return Data.storytellers[g.storyteller].last;
  };

  window.Ms = function() {
    if (Data.storytellers[g.storyteller].gender === 'f') {
      return 'Ms';
    } else {
      return 'Mr';
    }
  };

  window.she = function() {
    if (Data.storytellers[g.storyteller].gender === 'f') {
      return 'she';
    } else {
      return 'he';
    }
  };

  window.She = function() {
    if (Data.storytellers[g.storyteller].gender === 'f') {
      return 'She';
    } else {
      return 'He';
    }
  };

  window.her = function() {
    if (Data.storytellers[g.storyteller].gender === 'f') {
      return 'her';
    } else {
      return 'his';
    }
  };

  window.Her = function() {
    if (Data.storytellers[g.storyteller].gender === 'f') {
      return 'Her';
    } else {
      return 'His';
    }
  };

  window.woman = function() {
    if (Data.storytellers[g.storyteller].gender === 'f') {
      return 'woman';
    } else {
      return 'man';
    }
  };

  mistress.toString = mistress;

  Mistress.toString = Mistress;

  Mandy.toString = Mandy;

  Masterson.toString = Masterson;

  Ms.toString = Ms;

  she.toString = she;

  She.toString = She;

  her.toString = her;

  Her.toString = Her;

  woman.toString = woman;

  window.saveLabel = function(game, short) {
    if (short) {
      return "MaidensTale-" + game.day;
    } else {
      return (game.name === 'unnamed' ? 'Nameless' : game.name) + " - Day " + game.day + " - " + Data.storytellers[game.storyteller].first + " " + Data.storytellers[game.storyteller].last;
    }
  };

}).call(this);

(function() {
  var describeAdventure, findAventures, findChoices, findEvent, findJobs;

  findEvent = function() {
    var index, label, possibleEvents;
    possibleEvents = (function() {
      var results;
      results = [];
      for (label in Data.randomEvents) {
        if (conditionsMatch(label)) {
          results.push(label);
        }
      }
      return results;
    })();
    index = Math.floor(Math.random() * possibleEvents.length);
    return possibleEvents[index];
  };

  Data.events.PlanDay = {
    text: function() {
      var adventures, choice, choices, currentAdventure, index, info, possibleAdventures, possibleJobs, time, times;
      choices = (function() {
        var ref, results;
        ref = Data.dailyChoices;
        results = [];
        for (choice in ref) {
          info = ref[choice];
          if (Object.values(g[info.from]).filter(Boolean).length) {
            results.push(drawDropdown(g[choice], info.descriptions[g[choice]], findChoices(choice, info.from)));
          }
        }
        return results;
      })();
      times = (function() {
        var j, len, ref, results;
        ref = Data.times;
        results = [];
        for (index = j = 0, len = ref.length; j < len; index = ++j) {
          time = ref[index];
          possibleJobs = findJobs(time);
          choice = conditionsMatch(g.plans[index]) ? g.plans[index] : Object.keys(possibleJobs)[0];
          results.push(drawDropdown(Data.jobs[choice].description, describeEvent(choice), possibleJobs));
        }
        return results;
      })();
      possibleAdventures = findAventures();
      adventures = possibleAdventures ? (currentAdventure = adventureMatch(g.adventure) ? g.adventure : Object.firstValue(possibleAdventures).label, currentAdventure = Data.adventures[currentAdventure], "<tr><th>&nbsp;</th></tr>\n<tr><th colspan=\"" + times.length + "\">Adventures</th><th></th></tr>\n<tr>\n  <th colspan=\"" + times.length + "\">" + (drawDropdown(currentAdventure.description, describeAdventure(currentAdventure), possibleAdventures)) + "</th>\n  <th>--> <button title=\"Start this adventure\" onclick=\"Data.pseudoEvents.StartAdventure()\">Adventure</button></th>\n</tr>") : "";
      return "<h3>Day " + g.day + " " + (choices.join(' ')) + "</h3>\n\n<table>\n  <tr><th>" + (Data.times.join('</th><th>')) + "</th></tr>\n  <tr><th>" + (times.join('</th><th>')) + "</th><th>--> <button title=\"Take these actions\" onclick=\"Data.pseudoEvents.StartDay()\">Normal day</button></th></tr>\n  " + adventures + "\n</table>";
    },
    next: false
  };

  findJobs = function(time) {
    var event, label, possibleJobs, ref;
    possibleJobs = {};
    ref = Data.jobs;
    for (label in ref) {
      event = ref[label];
      if ((event.time === time || event.time === 'Any') && conditionsMatch(label)) {
        possibleJobs[event.description] = {
          click: "setDailyJob(\"" + time + "\", \"" + label + "\")",
          title: describeEvent(label)
        };
      }
    }
    return possibleJobs;
  };

  window.setDailyJob = function(time, label) {
    g.plans[Data.times.indexOf(time)] = label;
    return Data.pseudoEvents.Refresh();
  };

  findChoices = function(set, from) {
    var availableChoices, key, ref, value;
    availableChoices = {};
    ref = g[from];
    for (key in ref) {
      value = ref[key];
      if (value) {
        availableChoices[key] = {
          title: Data.dailyChoices[set].descriptions[key],
          click: "setDailyChoice(\"" + set + "\", \"" + key + "\")"
        };
      }
    }
    return availableChoices;
  };

  window.setDailyChoice = function(set, choice) {
    g[set] = choice;
    return Data.pseudoEvents.Refresh();
  };

  Data.pseudoEvents.StartDay = function() {
    var choice, eventTime, index, j, len, randomEvent, ref, ref1, time;
    randomEvent = findEvent();
    eventTime = (ref = Data.randomEvents[randomEvent]) != null ? ref.time : void 0;
    ref1 = Data.times;
    for (index = j = 0, len = ref1.length; j < len; index = ++j) {
      time = ref1[index];
      choice = conditionsMatch(g.plans[index]) ? g.plans[index] : Object.keys(findJobs(time))[0];
      g.upcoming.push(choice);
      if (eventTime === time) {
        g.upcoming.push(randomEvent);
      }
    }
    g.upcoming.push('PlanDay');
    g.day++;
    g.history.push([]);
    return applyEvent(g.upcoming.shift());
  };

  findAventures = function() {
    var adventure, adventures, label, ref;
    adventures = {};
    ref = Data.adventures;
    for (label in ref) {
      adventure = ref[label];
      if (adventureMatch(label)) {
        adventures[adventure.description] = {
          title: describeAdventure(adventure),
          click: "setDailyChoice(\"adventure\", \"" + label + "\")",
          label: label
        };
      }
    }
    if (Object.keys(adventures).length) {
      return adventures;
    } else {
      return false;
    }
  };

  describeAdventure = function(adventure) {
    var steps;
    steps = adventure.steps.map(function(step, index) {
      var symbol;
      symbol = g.events[adventure[index + 1]] != null ? '✓' : '○';
      return symbol + " " + Data.events[step].description;
    });
    steps.pop();
    return "" + (steps.join('\n'));
  };

  Data.pseudoEvents.StartAdventure = function(label) {
    var adventure, nextStep;
    g.upcoming.push('PlanDay');
    g.day++;
    g.history.push([]);
    adventure = Data.adventures[g.adventure];
    nextStep = adventure.steps.find(function(e, i) {
      return g.events[adventure.steps[i + 1]] == null;
    });
    return applyEvent(nextStep);
  };

}).call(this);

(function() {
  var months;

  months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

  window.domReady = function() {
    var e, last;
    last = Object.keys(localStorage).map(function(key) {
      return parseFloat(key) || 0;
    }).sort().pop();
    try {
      return newGame(JSON.parse(localStorage[last]));
    } catch (_error) {
      e = _error;
      return newGame();
    }
  };

  window.newGame = function(data) {
    var content;
    if (data == null) {
      data = {};
    }
    content = document.getElementById('content');
    while (content.firstChild) {
      content.removeChild(content.firstChild);
    }
    window.g = Object.defaultsDeep(data, Game);
    return drawHistory();
  };

  window.saveGame = function() {
    localStorage.setItem(Date.now(), JSON.stringify(g));
    document.getElementById('save').classList.add('saved');
    return setTimeout(function() {
      return document.getElementById('save').classList.remove('saved');
    }, 800);
  };

  window.loadGame = function(key) {
    if (key) {
      return newGame(JSON.parse(localStorage[key]));
    } else if (document.getElementsByClassName('load').length === 0 && document.getElementsByClassName('you').length === 0) {
      return window.applyEvent('LoadGame');
    }
  };

  window.aboutYou = function() {
    if (!(document.getElementsByClassName('load').length === 0 && document.getElementsByClassName('you').length === 0)) {
      return;
    }
    return applyEvent('AboutYou');
  };

  window.deleteGame = function(key) {
    var row;
    delete localStorage[key];
    row = document.getElementById('save-' + key);
    return row.parentNode.removeChild(row);
  };

  window.importGame = function(file) {
    var reader;
    if (!file) {
      return;
    }
    reader = new FileReader();
    reader.onload = function() {
      var data, e;
      try {
        data = JSON.parse(reader.result);
        return newGame(data);
      } catch (_error) {
        e = _error;
        return console.log(e);
      }
    };
    return reader.readAsText(file);
  };

  Data.events.LoadGame = {
    text: function() {
      var blob, date, e, key, save, saves;
      saves = (function() {
        var i, len, ref, results;
        ref = Object.keys(localStorage).sort().reverse();
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          key = ref[i];
          date = new Date(parseInt(key, 10));
          if (!date.getTime()) {
            continue;
          }
          try {
            save = JSON.parse(localStorage[key]);
          } catch (_error) {
            e = _error;
            delete localStorage[key];
            continue;
          }
          blob = new Blob([localStorage[key]], {
            type: 'text/plain'
          });
          results.push("<tr id=\"save-" + key + "\">\n  <td>" + (saveLabel(save)) + "</td>\n  <td>" + months[date.getMonth()] + " " + (date.getDate()) + ", " + (date.getHours()) + ":" + (date.getMinutes()) + "</td>\n  <td>\n    <button onclick=\"loadGame(" + key + ")\">Load</button>\n    <a class=\"export\" href=\"" + (URL.createObjectURL(blob)) + "\" download=\"" + (saveLabel(save, true)) + ".json\">Export</a>\n    <a onclick=\"deleteGame(" + key + ")\">Delete</a>\n  </td>\n</tr>");
        }
        return results;
      })();
      return "<table class=\"load\">\n  <tr><td colspan=\"3\">" + options + "<input type=\"file\" onchange=\"importGame(this.files[0])\"></td></tr>\n  " + (saves.join('\n')) + "\n</table>";
    },
    next: {
      Cancel: 'Back'
    }
  };

}).call(this);

(function() {
  var appendEvent, applyEffects, chooseNextEvent, clamp, conditionsEventMatch, conditionsEventMisc, currentEvent, describeDiff, describeEffects, describeTest, describeUnion, drawChoice, drawEvent, ext, getCond, getEvent, j, key, len, nextType, numberMatch, ref, ref1, setInteraction, setSelectedLabel, skillBonus, type, value;

  Data.pseudoEvents.Refresh = function() {
    var content, label, todayEvents;
    content = document.getElementById('content');
    content.removeChild(content.lastElementChild);
    todayEvents = g.history[g.history.length - 1];
    label = todayEvents[todayEvents.length - 1];
    return appendEvent(getEvent(label), null, false);
  };

  Data.pseudoEvents.Back = function() {
    var content, label, todayEvents;
    content = document.getElementById('content');
    content.removeChild(content.lastElementChild);
    content.removeChild(content.lastElementChild);
    todayEvents = g.history[g.history.length - 1];
    if (!(todayEvents.length >= 2)) {
      throw Error("Can't use Back to go to a previous day");
    }
    todayEvents.pop();
    label = todayEvents[todayEvents.length - 1];
    return appendEvent(getEvent(label), null, false);
  };

  ref = ['events', 'randomEvents', 'jobs'];
  for (j = 0, len = ref.length; j < len; j++) {
    type = ref[j];
    ref1 = Data[type];
    for (key in ref1) {
      value = ref1[key];
      while (value.ext) {
        ext = Data[type][value.ext];
        delete value.ext;
        Object.defaults(value, ext);
      }
    }
  }

  window.drawHistory = function() {
    var content, day, events, k, label, len1, ref2, text;
    content = document.getElementById('content');
    ref2 = g.history;
    for (day in ref2) {
      events = ref2[day];
      if (day > g.day - 5) {
        for (k = 0, len1 = events.length; k < len1; k++) {
          label = events[k];
          if (text = drawEvent(getEvent(label))) {
            content.appendChild(text);
          }
        }
      }
    }
    setInteraction(true);
    smoothScroll(content.offsetHeight);
    return content;
  };

  getEvent = function(label) {
    return Data.events[label] || Data.randomEvents[label] || Data.jobs[label];
  };

  currentEvent = null;

  window.options = function(options) {
    var label, option;
    if (options == null) {
      options = currentEvent.next;
    }
    if (!options) {
      throw new Error('No current event defined.');
    }
    return ((function() {
      var results;
      results = [];
      for (label in options) {
        option = options[label];
        if (conditionsMatch(option)) {
          results.push(drawChoice(label, option));
        }
      }
      return results;
    })()).join('');
  };

  options.toString = options;

  drawChoice = function(label, option) {
    var diff, i, k, mainTitle, ref2, skillBonus, spendOptions, union;
    if (typeof option === 'string') {
      return "<button disabled onclick='applyEvent(\"" + option + "\", \"" + label + "\")' title=\"" + (describeEvent(option)) + "\">" + label + "</button>";
    }
    skillBonus = Math.floor(g.skills[option.skill] / 10);
    union = describeUnion(option.result[0], option.result[1]);
    diff = [describeDiff(option.result[0], option.result[1]), describeDiff(option.result[1], option.result[0])];
    mainTitle = "" + (union ? union + '\n&nbsp;\n' : '') + option.skill + " (" + skillBonus + ") + " + (option.mood ? option.mood + ' +' : '') + " 2d6 vs " + option.diff + ":\n      " + (diff[0].replace(/\n/g, '\n      ')) + "\n--------or--------\n      " + (diff[1].replace(/\n/g, '\n      '));
    if (option.mood) {
      spendOptions = {};
      for (i = k = 0, ref2 = g.mood[option.mood]; 0 <= ref2 ? k <= ref2 : k >= ref2; i = 0 <= ref2 ? ++k : --k) {
        spendOptions[i + " " + option.mood] = {
          title: skillBonus + " + " + (i * 2) + " + 2d6 vs. " + option.diff,
          click: "applyTest(" + (JSON.stringify(option)) + ", \"" + label + "\", " + i + ")"
        };
      }
      return drawDropdown(label, mainTitle, spendOptions);
    } else {
      return "<button disabled onclick='applyTest(" + (JSON.stringify(option)) + ", \"" + label + "\")' title=\"" + mainTitle + "\">" + label + "</button>";
    }
  };

  window.drawDropdown = function(mainLabel, mainTitle, options) {
    var buttons, label, option;
    buttons = (function() {
      var results;
      results = [];
      for (label in options) {
        option = options[label];
        results.push("<button disabled onclick='" + option.click + "' title=\"" + option.title + "\">" + label + "</button>");
      }
      return results;
    })();
    return "<div class=\"clickMenu\" tabindex=\"0\">\n  <label class=\"disabled\" title=\"" + mainTitle + "\">" + mainLabel + "</label>\n  <div class=\"clickMenu-content\">" + (buttons.join('\n')) + "</div>\n</div>";
  };

  clamp = function(a, min, max) {
    a = Math.max(a, Math.floor(min));
    a = Math.min(a, Math.ceil(max));
    return a;
  };

  appendEvent = function(event, selectedLabel, scroll) {
    var content, text;
    if (scroll == null) {
      scroll = true;
    }
    content = document.getElementById('content');
    setSelectedLabel(selectedLabel, content.lastElementChild);
    text = drawEvent(event);
    if (text) {
      content.appendChild(text);
      setInteraction();
      if (content.children.length > 20) {
        window.scrollTo(0, window.scrollY - content.firstChild.scrollHeight);
        content.removeChild(content.firstChild);
      }
      if (scroll) {
        return setTimeout(function() {
          var header;
          header = document.getElementsByTagName('header')[0];
          return smoothScroll(text.offsetTop - 40 - header.scrollHeight);
        }, 0);
      }
    }
  };

  setSelectedLabel = function(label, div) {
    var button, k, len1, ref2, results;
    if (!div) {
      return;
    }
    ref2 = div.getElementsByTagName('button');
    results = [];
    for (k = 0, len1 = ref2.length; k < len1; k++) {
      button = ref2[k];
      if (button.innerHTML === label) {
        results.push(button.classList.add('clicked'));
      }
    }
    return results;
  };

  window.applyEvent = function(label, selectedLabel, scroll) {
    var event, next;
    if (scroll == null) {
      scroll = true;
    }
    if (Data.pseudoEvents[label]) {
      return Data.pseudoEvents[label](selectedLabel);
    }
    event = getEvent(label);
    appendEvent(event, selectedLabel, scroll);
    applyEffects(event.effects);
    g.events[label] = g.day;
    g.history[g.day].push(label);
    if (next = chooseNextEvent(event)) {
      return applyEvent(next, null, false);
    }
  };

  window.applyTest = function(test, selectedLabel, spent) {
    var content, div, e, mood, pass, roll, skill;
    if (spent == null) {
      spent = 0;
    }
    e = {};
    e[test.mood] = spent;
    applyEffects(e);
    roll = Math.ceil(Math.random() * 6) + Math.ceil(Math.random() * 6);
    mood = 2 * spent;
    skill = Math.floor(g.skills[test.skill] / 10);
    pass = roll + mood + skill >= test.diff;
    content = document.getElementById('content');
    div = document.createElement('div');
    div.classList.add('effects');
    mood = mood ? "<strong>" + mood + "</strong> (" + test.mood + ") + " : '';
    div.innerHTML = "<strong>" + (pass ? 'Pass' : 'Fail') + "</strong>: <strong>" + skill + "</strong> (" + test.skill + ") + " + mood + "<strong>" + roll + "</strong> (2d6) vs. " + test.diff;
    content.appendChild(div);
    return applyEvent((pass ? test.result[0] : test.result[1]), selectedLabel);
  };

  applyEffects = function(effects) {
    var amount, mood, opposed, ref2, ref3, ref4, skill, subKey, subValue;
    if (!effects) {
      return;
    }
    ref2 = effects.mood;
    for (mood in ref2) {
      amount = ref2[mood];
      opposed = Data.opposedMood[mood];
      g.mood[mood] = clamp(g.mood[mood] + amount, 0, 10 - g.mood[opposed]);
    }
    ref3 = effects.skills;
    for (skill in ref3) {
      amount = ref3[skill];
      if (g.mood[amount] != null) {
        amount = skillBonus(amount);
      }
      g.skills[skill] = clamp(g.skills[skill] + amount, 0, 100);
    }
    ref4 = effects.set;
    for (key in ref4) {
      value = ref4[key];
      if (typeof value === 'object') {
        for (subKey in value) {
          subValue = value[subKey];
          g[key][subKey] = subValue;
        }
      } else {
        g[key] = value;
      }
    }
    return typeof effects.call === "function" ? effects.call() : void 0;
  };

  skillBonus = function(mood) {
    return 2 + Math.floor(g.mood[mood] / 3);
  };

  window.describeEvent = function(label) {
    var amount, event, item, k, len1, ref2, ref3, ref4, text;
    event = getEvent(label);
    if (!event) {
      return '';
    }
    text = [];
    if (event.title) {
      text.push(event.title);
    }
    ref2 = ['mood', 'skills'];
    for (k = 0, len1 = ref2.length; k < len1; k++) {
      type = ref2[k];
      if ((ref3 = event.effects) != null ? ref3[type] : void 0) {
        ref4 = event.effects[type];
        for (item in ref4) {
          amount = ref4[item];
          if (g.mood[amount] != null) {
            text.push(item + " +" + (skillBonus(amount)) + " (" + amount + ")");
          } else {
            text.push(item + " +" + amount);
          }
        }
      }
    }
    return text.join('\n');
  };

  describeUnion = function(label1, label2) {
    var amount, event1, event2, item, k, len1, ref2, ref3, ref4, ref5, text;
    event1 = getEvent(label1);
    event2 = getEvent(label2);
    text = [];
    if (event1.description && event1.description === event2.description) {
      text.push(event1.description.call(event));
    }
    ref2 = ['mood', 'skills'];
    for (k = 0, len1 = ref2.length; k < len1; k++) {
      type = ref2[k];
      if (((ref3 = event1.effects) != null ? ref3[type] : void 0) && ((ref4 = event2.effects) != null ? ref4[type] : void 0)) {
        ref5 = event1.effects[type];
        for (item in ref5) {
          amount = ref5[item];
          if (event2.effects[type][item] === amount) {
            if (g.mood[amount] != null) {
              text.push(item + " +" + (skillBonus(amount)) + " (" + amount + ")");
            } else {
              text.push(item + " +" + amount);
            }
          }
        }
      }
    }
    return text.join('\n');
  };

  describeDiff = function(label1, label2) {
    var amount, event1, event2, item, k, len1, ref2, ref3, ref4, ref5, ref6, text;
    event1 = getEvent(label1);
    event2 = getEvent(label2);
    text = [];
    if (event1.description && event1.description !== event2.description) {
      text.push(event1.description);
    }
    ref2 = ['mood', 'skills'];
    for (k = 0, len1 = ref2.length; k < len1; k++) {
      type = ref2[k];
      if ((ref3 = event1.effects) != null ? ref3[type] : void 0) {
        ref4 = event1.effects[type];
        for (item in ref4) {
          amount = ref4[item];
          if (((ref5 = event2.effects) != null ? (ref6 = ref5[type]) != null ? ref6[item] : void 0 : void 0) !== amount) {
            if (g.mood[amount] != null) {
              text.push(item + " +" + (skillBonus(amount)) + " (" + amount + ")");
            } else {
              text.push(item + " +" + amount);
            }
          }
        }
      }
    }
    return text.join('\n');
  };

  describeTest = function(test) {
    var skillRating;
    skillRating = Math.floor(g.skills[test.skill] / 10);
    return "Test " + test.skill + ": " + skillRating + " + 2d6 vs. " + test.diff + "\n+2 for each " + test.mood + " spent (have " + g.mood[test.mood] + ")";
  };

  drawEvent = function(event) {
    var div, text;
    div = document.createElement('div');
    if (!event.text) {
      return;
    }
    currentEvent = event;
    text = describeEffects(event.description, event.effects) + event.text.call(event);
    if (!text) {
      return;
    }
    div.innerHTML = '<div>' + text.split('\n\n').filter(Boolean).join('</div><div>') + '</div>';
    return div;
  };

  describeEffects = function(description, effects) {
    var amount, item, k, len1, ref2, ref3, text;
    if (!(description || (effects != null ? effects.mood : void 0) || (effects != null ? effects.skills : void 0))) {
      return '';
    }
    text = [];
    ref2 = ['mood', 'skills'];
    for (k = 0, len1 = ref2.length; k < len1; k++) {
      type = ref2[k];
      if (effects != null ? effects[type] : void 0) {
        ref3 = effects[type];
        for (item in ref3) {
          amount = ref3[item];
          if (g.mood[amount] != null) {
            text.push(item + " +" + (skillBonus(amount)) + " (" + amount + ")");
          } else {
            text.push(item + " +" + amount);
          }
        }
      }
    }
    return "<div class=\"effects\">" + (description ? description + '<br>' : '') + (text.join(', ')) + "</div>";
  };

  setInteraction = function(interaction) {
    var button, child, content, k, l, label, len1, len2, len3, len4, len5, m, n, o, ref2, ref3, ref4, ref5, ref6;
    content = document.getElementById('content');
    ref2 = content.children;
    for (k = 0, len1 = ref2.length; k < len1; k++) {
      child = ref2[k];
      ref3 = child.getElementsByTagName('button');
      for (l = 0, len2 = ref3.length; l < len2; l++) {
        button = ref3[l];
        button.disabled = true;
      }
      ref4 = child.getElementsByTagName('label');
      for (m = 0, len3 = ref4.length; m < len3; m++) {
        label = ref4[m];
        label.classList.add('disabled');
      }
    }
    if (!content.lastElementChild) {
      return;
    }
    ref5 = content.lastElementChild.getElementsByTagName('button');
    for (n = 0, len4 = ref5.length; n < len4; n++) {
      button = ref5[n];
      button.disabled = false;
    }
    ref6 = content.lastElementChild.getElementsByTagName('label');
    for (o = 0, len5 = ref6.length; o < len5; o++) {
      label = ref6[o];
      label.classList.remove('disabled');
    }
  };

  chooseNextEvent = function(event) {
    if (event.next === false) {
      return false;
    }
    if (event.next) {
      if (typeof event.next === 'string' && conditionsMatch(event.next)) {
        return event.next;
      } else if (event.selectNext) {
        return nextType[event.selectNext](event.next.filter(conditionsMatch));
      }
    } else {
      return g.upcoming.shift();
    }
  };

  nextType = {
    first: function(e) {
      return e[0];
    },
    random: function(e) {
      return e[Math.floor(Math.random() * e.length)];
    },
    unused: function(e) {
      return events.filter(function(e) {
        return !g.events[e];
      })[0];
    },
    leastRecent: function(e) {
      return events.sort(sortLeastRecent)[0];
    }
  };

  window.conditionsMatch = function(label) {
    var conditions, k, len1, ref2, ref3, ref4, ref5;
    conditions = getCond(label);
    if (!conditions) {
      return true;
    }
    if (((ref2 = conditions.day) != null ? ref2[0] : void 0) > g.day || ((ref3 = conditions.day) != null ? ref3[1] : void 0) < g.day) {
      return false;
    }
    ref4 = ['mood', 'skills'];
    for (k = 0, len1 = ref4.length; k < len1; k++) {
      type = ref4[k];
      ref5 = conditions[type];
      for (key in ref5) {
        value = ref5[key];
        if (g[type][key] < value[0] || g[type][key] > value[1]) {
          return false;
        }
      }
    }
    if (!conditionsEventMatch(conditions.events)) {
      return false;
    }
    if (!conditionsEventMisc(conditions.misc)) {
      return false;
    }
    return true;
  };

  window.adventureMatch = function(label) {
    var adventure;
    adventure = Data.adventures[label];
    if (g.events[adventure.steps[adventure.steps.length - 1]]) {
      return false;
    }
    return conditionsMatch(adventure);
  };

  getCond = function(label) {
    return (Data.events[label] || Data.randomEvents[label] || Data.jobs[label] || Data.adventures[label] || label).conditions;
  };

  conditionsEventMatch = function(events) {
    var test;
    for (key in events) {
      test = events[key];
      value = g.events[key];
      if (test === true && (value == null)) {
        return false;
      }
      if (test === false && (value != null)) {
        return false;
      }
      if (typeof test === 'number' && !numberMatch(value, test)) {
        return false;
      }
    }
    return true;
  };

  conditionsEventMisc = function(misc) {
    for (key in misc) {
      value = misc[key];
      if (value[0] === '!') {
        if (g[key] === value.substr(1)) {
          return false;
        }
      } else if (g[key] !== value) {
        return false;
      }
    }
    return true;
  };

  numberMatch = function(value, test) {
    if (test >= 0) {
      if (!(value >= g.day - test)) {
        return false;
      }
    }
    if (test < 0) {
      if (value >= g.day + test) {
        return false;
      }
    }
  };

}).call(this);
</script>
    <style>body {
  background: #060606;
  color: #ccc;
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size: 15px;
  line-height: 1.7;
  margin: 0 auto;
  max-width: 760px;
  position: relative;
}
content {
  display: block;
  margin: 0 20px;
}
header {
  background: #000;
  height: 65px;
  max-width: 760px;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 10;
}
header h3, header h4 {
  float: left;
  margin: 15px;
}
header h3 { margin-left: 0; }
header h4.right {
  float: right;
}
a, a:visited {
  color: #69f;
  cursor: pointer;
  text-decoration: none;
  vertical-align: middle;
}
a:hover {
  color: #8df;
}
#save:after {
  content: "✓";
  font-size: 1.3em;
  margin-top: -2px;
  opacity: 0;
  padding-left: 5px;
  position: absolute;
  transition: opacity 0.3s;
  -webkit-transition: opacity 0.3s;
}
#save.saved:after {
  opacity: 1;
}
#content > div:first-child {
    padding-top: 65px;
}
#content div {
  margin-bottom: 20px;
}
#content > div {
  border-bottom: 2px solid #999;
  margin-bottom: 30px;
  padding-bottom: 10px;
}
button, .clickMenu > label {
  background-color: #424242;
  border: 1px solid #424242;
  border-radius: 6px;
  color: #fff;
  cursor: pointer;
  font-size: 13px;
  font-weight: 300;
  margin: 0 5px;
  padding: 3px 7px;
  white-space: nowrap;
}
button:hover, .clickMenu > label:hover {
  background-color: #282828;
}
button[disabled], button[disabled]:hover, .clickMenu > label.disabled, .clickMenu > label.disabled:hover {
  background-color: #424242;
  cursor: default;
  opacity: 0.65;
}
button.clicked {
  border-color: #999;
}
.load {
  border-collapse: collapse;
  width: 100%;
}
.load input {
  text-align: center;
  width: 30em;
}
.load tr {
  border-top: 1px solid #666;
}
.load tr:first-child {
  border: none;
}
.load td {
  padding: 8px;
  text-align: center;
}
.load td:first-child {
  text-align: left;
}
.load a {
  margin: 0 5px;
}
.load .export {
  color: #999;
  text-decoration: underline;
}
slider {
  border: 1px solid #666;
  border-radius: 6px;
  display: block;
  float: left;
  height: 17px;
  vertical-align: middle;
  width: 100px;
}
slider.right {
  border-radius: 0 6px 6px 0;
}
.stats slider {
  margin: 1em 0;
}
#content .sliders > div {
    display: inline-block;
    margin: 0;
    width: 240px;
}
.sliders label {
    float: left;
    width: 100px;
}
#content slider div {
  float: left;
  height: 17px;
  margin: 0;
}
slider div.bottom {
  border-top-left-radius: 6px;
  border-bottom-left-radius: 6px;
}
slider div.top {
  border-top-right-radius: 6px;
  border-bottom-right-radius: 6px;
}
slider div.skill {
  background-color: #77b300;
}
slider div.mood {
  background-color: #623;
}
slider div.opposed {
  background-color: #69f;
}
slider.right .bottom {
  border-bottom-left-radius: 0;
  border-top-left-radius: 0;
}
#content .clickMenu {
  position: relative;
  display: inline-block;
  margin-bottom: 0;
}
.clickMenu:focus {
  pointer-events: none;
  outline: none;
}
.clickMenu:focus .clickMenu-content {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}
.clickMenu-content {
  background: #060606;
  border-radius: 0 0 6px 6px;
  display: block;
  margin: 8px 0 0 calc(5px - 1em);
  opacity: 0; /* After it loses focus, hide it immediately, while the visibility transition leaves it clickable. */
  padding: 0 1em 1em 1em;
  position: absolute;
  text-align: center;
  transition: visibility 0.5s;
  visibility: hidden;
  z-index: 1;
}
.clickMenu-content button {
  border-radius: 0;
  margin: 1px;
  width: 100%;
}
.clickMenu-content button:first-child {
  border-top-left-radius: 6px;
  border-top-right-radius: 6px;
}
.clickMenu-content button:last-child {
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
}
#content .effects {
  border-bottom: none;
  font-size: 11px;
  font-style: italic;
  margin-bottom: 20px;
  margin-top: -20px;
  text-align: center;
}
</style>
  </head>
  <body onload="domReady()">
    <header>
      <h3>The Maiden's Tale</h3>
      <h4><a onclick="aboutYou()">You</a></h4>
      <h4 class="right"><a href="http://winds.blue" target="_blank">Site</a></h4>
      <h4 class="right"><a onclick="newGame()">New</a></h4>
      <h4 class="right"><a onclick="loadGame()">Load</a></h4>
      <h4 class="right"><a id="save" onclick="saveGame()">Save</a></h4>
    </header>
    <content id="content"></content>
  </body>
</html>
